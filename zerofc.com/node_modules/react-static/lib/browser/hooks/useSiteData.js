"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useSiteData = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _react = require("react");

var _axios = _interopRequireDefault(require("axios"));

var _2 = require("../");

var _useStaticInfo = require("./useStaticInfo");

//
// This will likely become a react cache resource soon
var siteDataPromise;
var siteDataReady;
var siteData;

var useSiteData = function useSiteData() {
  // When clientData reloads, rerender components
  // that use this hook
  // eslint-disable-next-line
  var _useState = (0, _react.useState)(0),
      _useState2 = (0, _slicedToArray2.default)(_useState, 2),
      _ = _useState2[0],
      setCount = _useState2[1];

  (0, _react.useEffect)(function () {
    return (0, _2.onReloadClientData)(function () {
      siteDataPromise = null;
      siteDataReady = false;
      setCount(function (old) {
        return old + 1;
      });
    });
  });
  var staticInfo = (0, _useStaticInfo.useStaticInfo)();

  if (staticInfo) {
    return staticInfo.siteData;
  }

  if (siteDataReady) {
    return siteData;
  }

  if (!siteDataPromise) {
    // Request the site data
    siteDataPromise = _axios.default.get('/__react-static__/siteData').then(function (_ref) {
      var data = _ref.data;
      siteDataReady = true;
      siteData = data;
    });
  } // Throw the promise


  throw siteDataPromise;
};

exports.useSiteData = useSiteData;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9icm93c2VyL2hvb2tzL3VzZVNpdGVEYXRhLmpzIl0sIm5hbWVzIjpbInNpdGVEYXRhUHJvbWlzZSIsInNpdGVEYXRhUmVhZHkiLCJzaXRlRGF0YSIsInVzZVNpdGVEYXRhIiwiXyIsInNldENvdW50Iiwib2xkIiwic3RhdGljSW5mbyIsImF4aW9zIiwiZ2V0IiwidGhlbiIsImRhdGEiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBRkE7QUFJQTtBQUNBLElBQUlBLGVBQUo7QUFDQSxJQUFJQyxhQUFKO0FBQ0EsSUFBSUMsUUFBSjs7QUFFTyxJQUFNQyxXQUFXLEdBQUcsU0FBZEEsV0FBYyxHQUFNO0FBQy9CO0FBQ0E7QUFDQTtBQUgrQixrQkFJVCxxQkFBUyxDQUFULENBSlM7QUFBQTtBQUFBLE1BSXhCQyxDQUp3QjtBQUFBLE1BSXJCQyxRQUpxQjs7QUFLL0Isd0JBQVU7QUFBQSxXQUNSLDJCQUFtQixZQUFNO0FBQ3ZCTCxNQUFBQSxlQUFlLEdBQUcsSUFBbEI7QUFDQUMsTUFBQUEsYUFBYSxHQUFHLEtBQWhCO0FBQ0FJLE1BQUFBLFFBQVEsQ0FBQyxVQUFBQyxHQUFHO0FBQUEsZUFBSUEsR0FBRyxHQUFHLENBQVY7QUFBQSxPQUFKLENBQVI7QUFDRCxLQUpELENBRFE7QUFBQSxHQUFWO0FBUUEsTUFBTUMsVUFBVSxHQUFHLG1DQUFuQjs7QUFFQSxNQUFJQSxVQUFKLEVBQWdCO0FBQ2QsV0FBT0EsVUFBVSxDQUFDTCxRQUFsQjtBQUNEOztBQUVELE1BQUlELGFBQUosRUFBbUI7QUFDakIsV0FBT0MsUUFBUDtBQUNEOztBQUVELE1BQUksQ0FBQ0YsZUFBTCxFQUFzQjtBQUNwQjtBQUNBQSxJQUFBQSxlQUFlLEdBQUdRLGVBQ2ZDLEdBRGUsQ0FDWCw0QkFEVyxFQUVmQyxJQUZlLENBRVYsZ0JBQWM7QUFBQSxVQUFYQyxJQUFXLFFBQVhBLElBQVc7QUFDbEJWLE1BQUFBLGFBQWEsR0FBRyxJQUFoQjtBQUNBQyxNQUFBQSxRQUFRLEdBQUdTLElBQVg7QUFDRCxLQUxlLENBQWxCO0FBTUQsR0EvQjhCLENBaUMvQjs7O0FBQ0EsUUFBTVgsZUFBTjtBQUNELENBbkNNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJ1xuLy9cbmltcG9ydCB7IG9uUmVsb2FkQ2xpZW50RGF0YSB9IGZyb20gJy4uLydcbmltcG9ydCB7IHVzZVN0YXRpY0luZm8gfSBmcm9tICcuL3VzZVN0YXRpY0luZm8nXG5cbi8vIFRoaXMgd2lsbCBsaWtlbHkgYmVjb21lIGEgcmVhY3QgY2FjaGUgcmVzb3VyY2Ugc29vblxubGV0IHNpdGVEYXRhUHJvbWlzZVxubGV0IHNpdGVEYXRhUmVhZHlcbmxldCBzaXRlRGF0YVxuXG5leHBvcnQgY29uc3QgdXNlU2l0ZURhdGEgPSAoKSA9PiB7XG4gIC8vIFdoZW4gY2xpZW50RGF0YSByZWxvYWRzLCByZXJlbmRlciBjb21wb25lbnRzXG4gIC8vIHRoYXQgdXNlIHRoaXMgaG9va1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgY29uc3QgW18sIHNldENvdW50XSA9IHVzZVN0YXRlKDApXG4gIHVzZUVmZmVjdCgoKSA9PlxuICAgIG9uUmVsb2FkQ2xpZW50RGF0YSgoKSA9PiB7XG4gICAgICBzaXRlRGF0YVByb21pc2UgPSBudWxsXG4gICAgICBzaXRlRGF0YVJlYWR5ID0gZmFsc2VcbiAgICAgIHNldENvdW50KG9sZCA9PiBvbGQgKyAxKVxuICAgIH0pXG4gIClcblxuICBjb25zdCBzdGF0aWNJbmZvID0gdXNlU3RhdGljSW5mbygpXG5cbiAgaWYgKHN0YXRpY0luZm8pIHtcbiAgICByZXR1cm4gc3RhdGljSW5mby5zaXRlRGF0YVxuICB9XG5cbiAgaWYgKHNpdGVEYXRhUmVhZHkpIHtcbiAgICByZXR1cm4gc2l0ZURhdGFcbiAgfVxuXG4gIGlmICghc2l0ZURhdGFQcm9taXNlKSB7XG4gICAgLy8gUmVxdWVzdCB0aGUgc2l0ZSBkYXRhXG4gICAgc2l0ZURhdGFQcm9taXNlID0gYXhpb3NcbiAgICAgIC5nZXQoJy9fX3JlYWN0LXN0YXRpY19fL3NpdGVEYXRhJylcbiAgICAgIC50aGVuKCh7IGRhdGEgfSkgPT4ge1xuICAgICAgICBzaXRlRGF0YVJlYWR5ID0gdHJ1ZVxuICAgICAgICBzaXRlRGF0YSA9IGRhdGFcbiAgICAgIH0pXG4gIH1cblxuICAvLyBUaHJvdyB0aGUgcHJvbWlzZVxuICB0aHJvdyBzaXRlRGF0YVByb21pc2Vcbn1cbiJdfQ==