"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getRouteInfo = getRouteInfo;
exports.prefetchData = prefetchData;
exports.prefetchTemplate = prefetchTemplate;
exports.prefetch = prefetch;
exports.isPrefetchableRoute = isPrefetchableRoute;
exports.plugins = exports.onReloadClientData = exports.registerTemplateForPath = exports.registerTemplates = exports.onReloadTemplates = exports.templateErrorByPath = exports.templatesByPath = exports.templates = exports.registerPlugins = exports.pluginHooks = exports.addPrefetchExcludes = exports.sharedDataByHash = exports.routeErrorByPath = exports.routeInfoByPath = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _axios = _interopRequireDefault(require("axios"));

var _utils = require("./utils");

var _Visibility = _interopRequireDefault(require("./utils/Visibility"));

//
// RouteInfo / RouteData
var routeInfoByPath = {};
exports.routeInfoByPath = routeInfoByPath;
var routeErrorByPath = {};
exports.routeErrorByPath = routeErrorByPath;
var sharedDataByHash = {};
exports.sharedDataByHash = sharedDataByHash;
var inflightRouteInfo = {};
var inflightPropHashes = {};
var prefetchExcludes = [];

var addPrefetchExcludes = function addPrefetchExcludes(excludes) {
  if (!Array.isArray(excludes)) {
    throw new Error('Excludes must be an array of strings/regex!');
  }

  prefetchExcludes = [].concat((0, _toConsumableArray2.default)(prefetchExcludes), (0, _toConsumableArray2.default)(excludes));
};

exports.addPrefetchExcludes = addPrefetchExcludes;
var requestPool = (0, _utils.createPool)({
  concurrency: Number(process.env.REACT_STATIC_PREFETCH_RATE)
}); // Plugins

var pluginHooks = [];
exports.pluginHooks = pluginHooks;

var registerPlugins = function registerPlugins(newPlugins) {
  pluginHooks.splice.apply(pluginHooks, [0, Infinity].concat((0, _toConsumableArray2.default)(newPlugins)));
}; // Templates


exports.registerPlugins = registerPlugins;
var templates = {};
exports.templates = templates;
var templatesByPath = {};
exports.templatesByPath = templatesByPath;
var templateErrorByPath = {};
exports.templateErrorByPath = templateErrorByPath;

var onReloadTemplates = function onReloadTemplates(fn) {
  onReloadTemplates.listeners.push(fn);
  return function () {
    onReloadTemplates.listeners = onReloadTemplates.listeners.filter(function (d) {
      return d !== fn;
    });
  };
};

exports.onReloadTemplates = onReloadTemplates;
onReloadTemplates.listeners = [];

var registerTemplates =
/*#__PURE__*/
function () {
  var _ref = (0, _asyncToGenerator2.default)(
  /*#__PURE__*/
  _regenerator.default.mark(function _callee(tmps, notFoundKey) {
    return _regenerator.default.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            Object.keys(templatesByPath).forEach(function (key) {
              delete templatesByPath[key];
            });
            Object.keys(templateErrorByPath).forEach(function (key) {
              delete templateErrorByPath[key];
            });
            Object.keys(templates).forEach(function (key) {
              delete templates[key];
            });
            Object.keys(tmps).forEach(function (key) {
              templates[key] = tmps[key];
            });
            templatesByPath['404'] = templates[notFoundKey];

            if (!(process.env.NODE_ENV === 'development' && typeof document !== 'undefined')) {
              _context.next = 8;
              break;
            }

            _context.next = 8;
            return prefetch(window.location.pathname);

          case 8:
            onReloadTemplates.listeners.forEach(function (fn) {
              return fn();
            });

            if (typeof document !== 'undefined') {
              console.log('React Static: Templates Reloaded');
            }

          case 10:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  }));

  return function registerTemplates(_x, _x2) {
    return _ref.apply(this, arguments);
  };
}();

exports.registerTemplates = registerTemplates;

var registerTemplateForPath = function registerTemplateForPath(path, template) {
  path = (0, _utils.getRoutePath)(path);
  templatesByPath[path] = templates[template];
};

exports.registerTemplateForPath = registerTemplateForPath;

var onReloadClientData = function onReloadClientData(fn) {
  Object.keys(routeErrorByPath).forEach(function (key) {
    delete routeErrorByPath[key];
  });
  onReloadClientData.listeners.push(fn);
  return function () {
    onReloadClientData.listeners = onReloadClientData.listeners.filter(function (d) {
      return d !== fn;
    });
  };
};

exports.onReloadClientData = onReloadClientData;
onReloadClientData.listeners = [];

if (typeof document !== 'undefined') {
  init();
} // When in development, init a socket to listen for data changes
// When the data changes, we invalidate and reload all of the route data


function init() {
  // In development, we need to open a socket to listen for changes to data
  if (process.env.REACT_STATIC_ENV === 'development') {
    var io = require('socket.io-client');

    var run =
    /*#__PURE__*/
    function () {
      var _ref2 = (0, _asyncToGenerator2.default)(
      /*#__PURE__*/
      _regenerator.default.mark(function _callee2() {
        var _ref3, port, socket;

        return _regenerator.default.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.prev = 0;
                _context2.next = 3;
                return _axios.default.get('/__react-static__/getMessagePort');

              case 3:
                _ref3 = _context2.sent;
                port = _ref3.data.port;
                socket = io("http://localhost:".concat(port));
                socket.on('connect', function () {// Do nothing
                });
                socket.on('message', function (_ref4) {
                  var type = _ref4.type;

                  if (type === 'reloadClientData') {
                    reloadClientData();
                  }
                });
                _context2.next = 14;
                break;

              case 10:
                _context2.prev = 10;
                _context2.t0 = _context2["catch"](0);
                console.log('React-Static data hot-loader websocket encountered the following error:');
                console.error(_context2.t0);

              case 14:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, null, [[0, 10]]);
      }));

      return function run() {
        return _ref2.apply(this, arguments);
      };
    }();

    run();
  }

  if (process.env.REACT_STATIC_DISABLE_PRELOAD === 'false') {
    startPreloader();
  }
}

function startPreloader() {
  if (typeof document !== 'undefined') {
    var run = function run() {
      var els = [].slice.call(document.getElementsByTagName('a'));
      els.forEach(function (el) {
        var href = el.getAttribute('href');
        var shouldPrefetch = !(el.getAttribute('prefetch') === 'false');

        if (href && shouldPrefetch) {
          (0, _Visibility.default)(el, function () {
            return prefetch(href);
          });
        }
      });
    };

    setInterval(run, Number(process.env.REACT_STATIC_PRELOAD_POLL_INTERVAL));
  }
}

function reloadClientData() {
  return _reloadClientData.apply(this, arguments);
}

function _reloadClientData() {
  _reloadClientData = (0, _asyncToGenerator2.default)(
  /*#__PURE__*/
  _regenerator.default.mark(function _callee3() {
    return _regenerator.default.wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            console.log('React Static: Reloading Data...') // Delete all cached data
            ;
            [routeInfoByPath, sharedDataByHash, routeErrorByPath, inflightRouteInfo, inflightPropHashes].forEach(function (part) {
              Object.keys(part).forEach(function (key) {
                delete part[key];
              });
            }); // Prefetch the current route's data before you reload routes

            _context3.next = 4;
            return prefetch(window.location.pathname);

          case 4:
            onReloadClientData.listeners.forEach(function (fn) {
              return fn();
            });

          case 5:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3);
  }));
  return _reloadClientData.apply(this, arguments);
}

function getRouteInfo(_x3) {
  return _getRouteInfo.apply(this, arguments);
}

function _getRouteInfo() {
  _getRouteInfo = (0, _asyncToGenerator2.default)(
  /*#__PURE__*/
  _regenerator.default.mark(function _callee4(path) {
    var _ref5,
        priority,
        routeInfo,
        _ref8,
        data,
        routeInfoRoot,
        getPath,
        _ref9,
        _data,
        _ref10,
        _data2,
        _args4 = arguments;

    return _regenerator.default.wrap(function _callee4$(_context4) {
      while (1) {
        switch (_context4.prev = _context4.next) {
          case 0:
            _ref5 = _args4.length > 1 && _args4[1] !== undefined ? _args4[1] : {}, priority = _ref5.priority;
            path = (0, _utils.getRoutePath)(path); // Check if we should fetch RouteData for this url et all.

            if (isPrefetchableRoute(path)) {
              _context4.next = 4;
              break;
            }

            return _context4.abrupt("return");

          case 4:
            if (!routeInfoByPath[path]) {
              _context4.next = 6;
              break;
            }

            return _context4.abrupt("return", routeInfoByPath[path]);

          case 6:
            if (!routeErrorByPath[path]) {
              _context4.next = 8;
              break;
            }

            return _context4.abrupt("return");

          case 8:
            _context4.prev = 8;

            if (!(process.env.REACT_STATIC_ENV === 'development')) {
              _context4.next = 18;
              break;
            }

            // In dev, request from the webpack dev server
            if (!inflightRouteInfo[path]) {
              inflightRouteInfo[path] = _axios.default.get("/__react-static__/routeInfo/".concat(path === '/' ? '' : path));
            }

            _context4.next = 13;
            return inflightRouteInfo[path];

          case 13:
            _ref8 = _context4.sent;
            data = _ref8.data;
            routeInfo = data;
            _context4.next = 34;
            break;

          case 18:
            // In production, fetch the JSON file
            // Find the location of the routeInfo.json file
            routeInfoRoot = (process.env.REACT_STATIC_DISABLE_ROUTE_PREFIXING === 'true' ? process.env.REACT_STATIC_SITE_ROOT : process.env.REACT_STATIC_PUBLIC_PATH) || '/';
            getPath = "".concat(routeInfoRoot).concat((0, _utils.pathJoin)(path, 'routeInfo.json')); // If this is a priority call bypass the queue

            if (!priority) {
              _context4.next = 28;
              break;
            }

            _context4.next = 23;
            return _axios.default.get(getPath);

          case 23:
            _ref9 = _context4.sent;
            _data = _ref9.data;
            routeInfo = _data;
            _context4.next = 34;
            break;

          case 28:
            // Otherwise, add it to the queue
            if (!inflightRouteInfo[path]) {
              inflightRouteInfo[path] = requestPool.add(function () {
                return _axios.default.get(getPath);
              });
            }

            _context4.next = 31;
            return inflightRouteInfo[path];

          case 31:
            _ref10 = _context4.sent;
            _data2 = _ref10.data;
            routeInfo = _data2;

          case 34:
            _context4.next = 43;
            break;

          case 36:
            _context4.prev = 36;
            _context4.t0 = _context4["catch"](8);
            // If there was an error, mark the path as errored
            routeErrorByPath[path] = true; // Unless we already fetched the 404 page,
            // try to load info for the 404 page

            if (!(!routeInfoByPath['404'] && !routeErrorByPath['404'])) {
              _context4.next = 42;
              break;
            }

            getRouteInfo('404', {
              priority: priority
            });
            return _context4.abrupt("return");

          case 42:
            return _context4.abrupt("return");

          case 43:
            if (!priority) {
              delete inflightRouteInfo[path];
            }

            if ((0, _typeof2.default)(routeInfo) !== 'object' || !routeInfo.path) {
              // routeInfo must have returned 200, but is not actually
              // a routeInfo object. Mark it as an error and move on silently
              routeErrorByPath[path] = true;
            } else {
              routeInfoByPath[path] = routeInfo;
            }

            return _context4.abrupt("return", routeInfoByPath[path]);

          case 46:
          case "end":
            return _context4.stop();
        }
      }
    }, _callee4, null, [[8, 36]]);
  }));
  return _getRouteInfo.apply(this, arguments);
}

function prefetchData(_x4) {
  return _prefetchData.apply(this, arguments);
}

function _prefetchData() {
  _prefetchData = (0, _asyncToGenerator2.default)(
  /*#__PURE__*/
  _regenerator.default.mark(function _callee6(path) {
    var _ref6,
        priority,
        routeInfo,
        _args6 = arguments;

    return _regenerator.default.wrap(function _callee6$(_context6) {
      while (1) {
        switch (_context6.prev = _context6.next) {
          case 0:
            _ref6 = _args6.length > 1 && _args6[1] !== undefined ? _args6[1] : {}, priority = _ref6.priority;
            _context6.next = 3;
            return getRouteInfo(path, {
              priority: priority
            });

          case 3:
            routeInfo = _context6.sent;

            if (routeInfo) {
              _context6.next = 6;
              break;
            }

            return _context6.abrupt("return");

          case 6:
            if (!routeInfo.sharedData) {
              _context6.next = 8;
              break;
            }

            return _context6.abrupt("return", (0, _utils.getFullRouteData)(routeInfo));

          case 8:
            // Request and build the props one by one
            routeInfo.sharedData = {}; // Request the template and loop over the routeInfo.sharedHashesByProp, requesting each prop

            _context6.next = 11;
            return Promise.all(Object.keys(routeInfo.sharedHashesByProp).map(
            /*#__PURE__*/
            function () {
              var _ref11 = (0, _asyncToGenerator2.default)(
              /*#__PURE__*/
              _regenerator.default.mark(function _callee5(key) {
                var hash, staticDataPath, absoluteStaticDataPath, _ref12, prop, _ref13, _prop;

                return _regenerator.default.wrap(function _callee5$(_context5) {
                  while (1) {
                    switch (_context5.prev = _context5.next) {
                      case 0:
                        hash = routeInfo.sharedHashesByProp[key]; // Check the sharedDataByHash first

                        if (sharedDataByHash[hash]) {
                          _context5.next = 26;
                          break;
                        }

                        _context5.prev = 2;
                        staticDataPath = (0, _utils.pathJoin)(process.env.REACT_STATIC_ASSETS_PATH, "staticData/".concat(hash, ".json"));
                        absoluteStaticDataPath = (0, _utils.makePathAbsolute)(staticDataPath); // If priority, get it immediately

                        if (!priority) {
                          _context5.next = 13;
                          break;
                        }

                        _context5.next = 8;
                        return _axios.default.get(absoluteStaticDataPath);

                      case 8:
                        _ref12 = _context5.sent;
                        prop = _ref12.data;
                        sharedDataByHash[hash] = prop;
                        _context5.next = 19;
                        break;

                      case 13:
                        // Non priority, share inflight requests and use pool
                        if (!inflightPropHashes[hash]) {
                          inflightPropHashes[hash] = requestPool.add(function () {
                            return _axios.default.get(absoluteStaticDataPath);
                          });
                        }

                        _context5.next = 16;
                        return inflightPropHashes[hash];

                      case 16:
                        _ref13 = _context5.sent;
                        _prop = _ref13.data;
                        // Place it in the cache
                        sharedDataByHash[hash] = _prop;

                      case 19:
                        _context5.next = 25;
                        break;

                      case 21:
                        _context5.prev = 21;
                        _context5.t0 = _context5["catch"](2);
                        console.log('Error: There was an error retrieving a prop for this route! hashID:', hash);
                        console.error(_context5.t0);

                      case 25:
                        if (!priority) {
                          delete inflightPropHashes[hash];
                        }

                      case 26:
                        // Otherwise, just set it as the key
                        routeInfo.sharedData[key] = sharedDataByHash[hash];

                      case 27:
                      case "end":
                        return _context5.stop();
                    }
                  }
                }, _callee5, null, [[2, 21]]);
              }));

              return function (_x7) {
                return _ref11.apply(this, arguments);
              };
            }()));

          case 11:
            return _context6.abrupt("return", (0, _utils.getFullRouteData)(routeInfo));

          case 12:
          case "end":
            return _context6.stop();
        }
      }
    }, _callee6);
  }));
  return _prefetchData.apply(this, arguments);
}

function prefetchTemplate(_x5) {
  return _prefetchTemplate.apply(this, arguments);
}

function _prefetchTemplate() {
  _prefetchTemplate = (0, _asyncToGenerator2.default)(
  /*#__PURE__*/
  _regenerator.default.mark(function _callee7(path) {
    var _ref7,
        priority,
        routeInfo,
        Template,
        _args7 = arguments;

    return _regenerator.default.wrap(function _callee7$(_context7) {
      while (1) {
        switch (_context7.prev = _context7.next) {
          case 0:
            _ref7 = _args7.length > 1 && _args7[1] !== undefined ? _args7[1] : {}, priority = _ref7.priority;
            // Clean the path
            path = (0, _utils.getRoutePath)(path); // Get route info so we can check if path has any data

            _context7.next = 4;
            return getRouteInfo(path, {
              priority: priority
            });

          case 4:
            routeInfo = _context7.sent;

            if (routeInfo) {
              // Make sure to use the path as defined in the routeInfo object here.
              // This will make sure 404 route info returned from getRouteInfo is handled correctly.
              registerTemplateForPath(routeInfo.path, routeInfo.template);
            } // Preload the template if available


            Template = templatesByPath[path];

            if (Template) {
              _context7.next = 10;
              break;
            }

            // If no template was found, mark it with an error
            templateErrorByPath[path] = true;
            return _context7.abrupt("return");

          case 10:
            if (routeInfo) {
              _context7.next = 12;
              break;
            }

            return _context7.abrupt("return", Template);

          case 12:
            if (!(!routeInfo.templateLoaded && Template.preload)) {
              _context7.next = 21;
              break;
            }

            if (!priority) {
              _context7.next = 18;
              break;
            }

            _context7.next = 16;
            return Template.preload();

          case 16:
            _context7.next = 20;
            break;

          case 18:
            _context7.next = 20;
            return requestPool.add(function () {
              return Template.preload();
            });

          case 20:
            routeInfo.templateLoaded = true;

          case 21:
            return _context7.abrupt("return", Template);

          case 22:
          case "end":
            return _context7.stop();
        }
      }
    }, _callee7);
  }));
  return _prefetchTemplate.apply(this, arguments);
}

function prefetch(_x6) {
  return _prefetch.apply(this, arguments);
}

function _prefetch() {
  _prefetch = (0, _asyncToGenerator2.default)(
  /*#__PURE__*/
  _regenerator.default.mark(function _callee8(path) {
    var options,
        type,
        data,
        _ref14,
        _ref15,
        _args8 = arguments;

    return _regenerator.default.wrap(function _callee8$(_context8) {
      while (1) {
        switch (_context8.prev = _context8.next) {
          case 0:
            options = _args8.length > 1 && _args8[1] !== undefined ? _args8[1] : {};
            // Clean the path
            path = (0, _utils.getRoutePath)(path);
            type = options.type; // If it's priority, we stop the queue temporarily

            if (options.priority) {
              requestPool.stop();
            }

            if (!(type === 'data')) {
              _context8.next = 10;
              break;
            }

            _context8.next = 7;
            return prefetchData(path, options);

          case 7:
            data = _context8.sent;
            _context8.next = 21;
            break;

          case 10:
            if (!(type === 'template')) {
              _context8.next = 15;
              break;
            }

            _context8.next = 13;
            return prefetchTemplate(path, options);

          case 13:
            _context8.next = 21;
            break;

          case 15:
            ;
            _context8.next = 18;
            return Promise.all([prefetchData(path, options), prefetchTemplate(path, options)]);

          case 18:
            _ref14 = _context8.sent;
            _ref15 = (0, _slicedToArray2.default)(_ref14, 1);
            data = _ref15[0];

          case 21:
            // If it was priority, start the queue again
            if (options.priority) {
              requestPool.start();
            }

            return _context8.abrupt("return", data);

          case 23:
          case "end":
            return _context8.stop();
        }
      }
    }, _callee8);
  }));
  return _prefetch.apply(this, arguments);
}

function isPrefetchableRoute(path) {
  // when rendering static pages we dont need this at all
  if (typeof document === 'undefined') {
    return false;
  }

  if (prefetchExcludes.some(function (exclude) {
    if (typeof exclude === 'string' && path.startsWith(exclude)) {
      return true;
    }

    if ((0, _typeof2.default)(exclude) === 'object' && exclude.test(path)) {
      return true;
    }

    return false;
  })) {
    return false;
  }

  var _document = document,
      location = _document.location;
  var link;

  try {
    link = new URL(path, location.href);
  } catch (e) {
    // Return false on invalid URLs
    return false;
  } // if the hostname/port/protocol doesn't match its not a route link


  if (location.host !== link.host || location.protocol !== link.protocol) {
    return false;
  } // deny all files with extension other than .html


  if (link.pathname.includes('.') && !link.pathname.includes('.html')) {
    return false;
  }

  return true;
}

var plugins = {
  Root: function Root(Comp) {
    var hooks = (0, _utils.getHooks)(pluginHooks, 'Root');
    return (0, _utils.reduceHooks)(hooks, {
      sync: true
    })(Comp);
  },
  Routes: function Routes(Comp) {
    var hooks = (0, _utils.getHooks)(pluginHooks, 'Routes');
    return (0, _utils.reduceHooks)(hooks, {
      sync: true
    })(Comp);
  }
};
exports.plugins = plugins;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9icm93c2VyL2luZGV4LmpzIl0sIm5hbWVzIjpbInJvdXRlSW5mb0J5UGF0aCIsInJvdXRlRXJyb3JCeVBhdGgiLCJzaGFyZWREYXRhQnlIYXNoIiwiaW5mbGlnaHRSb3V0ZUluZm8iLCJpbmZsaWdodFByb3BIYXNoZXMiLCJwcmVmZXRjaEV4Y2x1ZGVzIiwiYWRkUHJlZmV0Y2hFeGNsdWRlcyIsImV4Y2x1ZGVzIiwiQXJyYXkiLCJpc0FycmF5IiwiRXJyb3IiLCJyZXF1ZXN0UG9vbCIsImNvbmN1cnJlbmN5IiwiTnVtYmVyIiwicHJvY2VzcyIsImVudiIsIlJFQUNUX1NUQVRJQ19QUkVGRVRDSF9SQVRFIiwicGx1Z2luSG9va3MiLCJyZWdpc3RlclBsdWdpbnMiLCJuZXdQbHVnaW5zIiwic3BsaWNlIiwiSW5maW5pdHkiLCJ0ZW1wbGF0ZXMiLCJ0ZW1wbGF0ZXNCeVBhdGgiLCJ0ZW1wbGF0ZUVycm9yQnlQYXRoIiwib25SZWxvYWRUZW1wbGF0ZXMiLCJmbiIsImxpc3RlbmVycyIsInB1c2giLCJmaWx0ZXIiLCJkIiwicmVnaXN0ZXJUZW1wbGF0ZXMiLCJ0bXBzIiwibm90Rm91bmRLZXkiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsImtleSIsIk5PREVfRU5WIiwiZG9jdW1lbnQiLCJwcmVmZXRjaCIsIndpbmRvdyIsImxvY2F0aW9uIiwicGF0aG5hbWUiLCJjb25zb2xlIiwibG9nIiwicmVnaXN0ZXJUZW1wbGF0ZUZvclBhdGgiLCJwYXRoIiwidGVtcGxhdGUiLCJvblJlbG9hZENsaWVudERhdGEiLCJpbml0IiwiUkVBQ1RfU1RBVElDX0VOViIsImlvIiwicmVxdWlyZSIsInJ1biIsImF4aW9zIiwiZ2V0IiwicG9ydCIsImRhdGEiLCJzb2NrZXQiLCJvbiIsInR5cGUiLCJyZWxvYWRDbGllbnREYXRhIiwiZXJyb3IiLCJSRUFDVF9TVEFUSUNfRElTQUJMRV9QUkVMT0FEIiwic3RhcnRQcmVsb2FkZXIiLCJlbHMiLCJzbGljZSIsImNhbGwiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImVsIiwiaHJlZiIsImdldEF0dHJpYnV0ZSIsInNob3VsZFByZWZldGNoIiwic2V0SW50ZXJ2YWwiLCJSRUFDVF9TVEFUSUNfUFJFTE9BRF9QT0xMX0lOVEVSVkFMIiwicGFydCIsImdldFJvdXRlSW5mbyIsInByaW9yaXR5IiwiaXNQcmVmZXRjaGFibGVSb3V0ZSIsInJvdXRlSW5mbyIsInJvdXRlSW5mb1Jvb3QiLCJSRUFDVF9TVEFUSUNfRElTQUJMRV9ST1VURV9QUkVGSVhJTkciLCJSRUFDVF9TVEFUSUNfU0lURV9ST09UIiwiUkVBQ1RfU1RBVElDX1BVQkxJQ19QQVRIIiwiZ2V0UGF0aCIsImFkZCIsInByZWZldGNoRGF0YSIsInNoYXJlZERhdGEiLCJQcm9taXNlIiwiYWxsIiwic2hhcmVkSGFzaGVzQnlQcm9wIiwibWFwIiwiaGFzaCIsInN0YXRpY0RhdGFQYXRoIiwiUkVBQ1RfU1RBVElDX0FTU0VUU19QQVRIIiwiYWJzb2x1dGVTdGF0aWNEYXRhUGF0aCIsInByb3AiLCJwcmVmZXRjaFRlbXBsYXRlIiwiVGVtcGxhdGUiLCJ0ZW1wbGF0ZUxvYWRlZCIsInByZWxvYWQiLCJvcHRpb25zIiwic3RvcCIsInN0YXJ0Iiwic29tZSIsImV4Y2x1ZGUiLCJzdGFydHNXaXRoIiwidGVzdCIsImxpbmsiLCJVUkwiLCJlIiwiaG9zdCIsInByb3RvY29sIiwiaW5jbHVkZXMiLCJwbHVnaW5zIiwiUm9vdCIsIkNvbXAiLCJob29rcyIsInN5bmMiLCJSb3V0ZXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBOztBQVNBOztBQVZBO0FBWUE7QUFDTyxJQUFNQSxlQUFlLEdBQUcsRUFBeEI7O0FBQ0EsSUFBTUMsZ0JBQWdCLEdBQUcsRUFBekI7O0FBQ0EsSUFBTUMsZ0JBQWdCLEdBQUcsRUFBekI7O0FBQ1AsSUFBTUMsaUJBQWlCLEdBQUcsRUFBMUI7QUFDQSxJQUFNQyxrQkFBa0IsR0FBRyxFQUEzQjtBQUNBLElBQUlD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QUFJO0FBQ1osUUFBTUMsS0FBSyxHQUFHLHFCQUFTckcsV0FBVCxFQUFzQixNQUF0QixDQUFkO0FBQ0EsV0FBTyx3QkFBWXFHLEtBQVosRUFBbUI7QUFBRUMsTUFBQUEsSUFBSSxFQUFFO0FBQVIsS0FBbkIsRUFBbUNGLElBQW5DLENBQVA7QUFDRCxHQUpvQjtBQUtyQkcsRUFBQUEsTUFBTSxFQUFFLGdCQUFBSCxJQUFJLEVBQUk7QUFDZCxRQUFNQyxLQUFLLEdBQUcscUJBQVNyRyxXQUFULEVBQXNCLFFBQXRCLENBQWQ7QUFDQSxXQUFPLHdCQUFZcUcsS0FBWixFQUFtQjtBQUFFQyxNQUFBQSxJQUFJLEVBQUU7QUFBUixLQUFuQixFQUFtQ0YsSUFBbkMsQ0FBUDtBQUNEO0FBUm9CLENBQWhCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJ1xuLy9cbmltcG9ydCB7XG4gIGNyZWF0ZVBvb2wsXG4gIGdldFJvdXRlUGF0aCxcbiAgcGF0aEpvaW4sXG4gIGdldEZ1bGxSb3V0ZURhdGEsXG4gIG1ha2VQYXRoQWJzb2x1dGUsXG4gIGdldEhvb2tzLFxuICByZWR1Y2VIb29rcyxcbn0gZnJvbSAnLi91dGlscydcbmltcG9ydCBvblZpc2libGUgZnJvbSAnLi91dGlscy9WaXNpYmlsaXR5J1xuXG4vLyBSb3V0ZUluZm8gLyBSb3V0ZURhdGFcbmV4cG9ydCBjb25zdCByb3V0ZUluZm9CeVBhdGggPSB7fVxuZXhwb3J0IGNvbnN0IHJvdXRlRXJyb3JCeVBhdGggPSB7fVxuZXhwb3J0IGNvbnN0IHNoYXJlZERhdGFCeUhhc2ggPSB7fVxuY29uc3QgaW5mbGlnaHRSb3V0ZUluZm8gPSB7fVxuY29uc3QgaW5mbGlnaHRQcm9wSGFzaGVzID0ge31cbmxldCBwcmVmZXRjaEV4Y2x1ZGVzID0gW11cblxuZXhwb3J0IGNvbnN0IGFkZFByZWZldGNoRXhjbHVkZXMgPSBleGNsdWRlcyA9PiB7XG4gIGlmICghQXJyYXkuaXNBcnJheShleGNsdWRlcykpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4Y2x1ZGVzIG11c3QgYmUgYW4gYXJyYXkgb2Ygc3RyaW5ncy9yZWdleCEnKVxuICB9XG4gIHByZWZldGNoRXhjbHVkZXMgPSBbLi4ucHJlZmV0Y2hFeGNsdWRlcywgLi4uZXhjbHVkZXNdXG59XG5cbmNvbnN0IHJlcXVlc3RQb29sID0gY3JlYXRlUG9vbCh7XG4gIGNvbmN1cnJlbmN5OiBOdW1iZXIocHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX1BSRUZFVENIX1JBVEUpLFxufSlcblxuLy8gUGx1Z2luc1xuZXhwb3J0IGNvbnN0IHBsdWdpbkhvb2tzID0gW11cbmV4cG9ydCBjb25zdCByZWdpc3RlclBsdWdpbnMgPSBuZXdQbHVnaW5zID0+IHtcbiAgcGx1Z2luSG9va3Muc3BsaWNlKDAsIEluZmluaXR5LCAuLi5uZXdQbHVnaW5zKVxufVxuXG4vLyBUZW1wbGF0ZXNcbmV4cG9ydCBjb25zdCB0ZW1wbGF0ZXMgPSB7fVxuZXhwb3J0IGNvbnN0IHRlbXBsYXRlc0J5UGF0aCA9IHt9XG5leHBvcnQgY29uc3QgdGVtcGxhdGVFcnJvckJ5UGF0aCA9IHt9XG5leHBvcnQgY29uc3Qgb25SZWxvYWRUZW1wbGF0ZXMgPSBmbiA9PiB7XG4gIG9uUmVsb2FkVGVtcGxhdGVzLmxpc3RlbmVycy5wdXNoKGZuKVxuICByZXR1cm4gKCkgPT4ge1xuICAgIG9uUmVsb2FkVGVtcGxhdGVzLmxpc3RlbmVycyA9IG9uUmVsb2FkVGVtcGxhdGVzLmxpc3RlbmVycy5maWx0ZXIoXG4gICAgICBkID0+IGQgIT09IGZuXG4gICAgKVxuICB9XG59XG5vblJlbG9hZFRlbXBsYXRlcy5saXN0ZW5lcnMgPSBbXVxuXG5leHBvcnQgY29uc3QgcmVnaXN0ZXJUZW1wbGF0ZXMgPSBhc3luYyAodG1wcywgbm90Rm91bmRLZXkpID0+IHtcbiAgT2JqZWN0LmtleXModGVtcGxhdGVzQnlQYXRoKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgZGVsZXRlIHRlbXBsYXRlc0J5UGF0aFtrZXldXG4gIH0pXG4gIE9iamVjdC5rZXlzKHRlbXBsYXRlRXJyb3JCeVBhdGgpLmZvckVhY2goa2V5ID0+IHtcbiAgICBkZWxldGUgdGVtcGxhdGVFcnJvckJ5UGF0aFtrZXldXG4gIH0pXG4gIE9iamVjdC5rZXlzKHRlbXBsYXRlcykuZm9yRWFjaChrZXkgPT4ge1xuICAgIGRlbGV0ZSB0ZW1wbGF0ZXNba2V5XVxuICB9KVxuICBPYmplY3Qua2V5cyh0bXBzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgdGVtcGxhdGVzW2tleV0gPSB0bXBzW2tleV1cbiAgfSlcbiAgdGVtcGxhdGVzQnlQYXRoWyc0MDQnXSA9IHRlbXBsYXRlc1tub3RGb3VuZEtleV1cblxuICBpZiAoXG4gICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgJiZcbiAgICB0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnXG4gICkge1xuICAgIGF3YWl0IHByZWZldGNoKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSlcbiAgfVxuXG4gIG9uUmVsb2FkVGVtcGxhdGVzLmxpc3RlbmVycy5mb3JFYWNoKGZuID0+IGZuKCkpXG5cbiAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBjb25zb2xlLmxvZygnUmVhY3QgU3RhdGljOiBUZW1wbGF0ZXMgUmVsb2FkZWQnKVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCByZWdpc3RlclRlbXBsYXRlRm9yUGF0aCA9IChwYXRoLCB0ZW1wbGF0ZSkgPT4ge1xuICBwYXRoID0gZ2V0Um91dGVQYXRoKHBhdGgpXG4gIHRlbXBsYXRlc0J5UGF0aFtwYXRoXSA9IHRlbXBsYXRlc1t0ZW1wbGF0ZV1cbn1cblxuZXhwb3J0IGNvbnN0IG9uUmVsb2FkQ2xpZW50RGF0YSA9IGZuID0+IHtcbiAgT2JqZWN0LmtleXMocm91dGVFcnJvckJ5UGF0aCkuZm9yRWFjaChrZXkgPT4ge1xuICAgIGRlbGV0ZSByb3V0ZUVycm9yQnlQYXRoW2tleV1cbiAgfSlcbiAgb25SZWxvYWRDbGllbnREYXRhLmxpc3RlbmVycy5wdXNoKGZuKVxuICByZXR1cm4gKCkgPT4ge1xuICAgIG9uUmVsb2FkQ2xpZW50RGF0YS5saXN0ZW5lcnMgPSBvblJlbG9hZENsaWVudERhdGEubGlzdGVuZXJzLmZpbHRlcihcbiAgICAgIGQgPT4gZCAhPT0gZm5cbiAgICApXG4gIH1cbn1cbm9uUmVsb2FkQ2xpZW50RGF0YS5saXN0ZW5lcnMgPSBbXVxuXG5pZiAodHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJykge1xuICBpbml0KClcbn1cblxuLy8gV2hlbiBpbiBkZXZlbG9wbWVudCwgaW5pdCBhIHNvY2tldCB0byBsaXN0ZW4gZm9yIGRhdGEgY2hhbmdlc1xuLy8gV2hlbiB0aGUgZGF0YSBjaGFuZ2VzLCB3ZSBpbnZhbGlkYXRlIGFuZCByZWxvYWQgYWxsIG9mIHRoZSByb3V0ZSBkYXRhXG5mdW5jdGlvbiBpbml0KCkge1xuICAvLyBJbiBkZXZlbG9wbWVudCwgd2UgbmVlZCB0byBvcGVuIGEgc29ja2V0IHRvIGxpc3RlbiBmb3IgY2hhbmdlcyB0byBkYXRhXG4gIGlmIChwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gICAgY29uc3QgaW8gPSByZXF1aXJlKCdzb2NrZXQuaW8tY2xpZW50JylcbiAgICBjb25zdCBydW4gPSBhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgZGF0YTogeyBwb3J0IH0sXG4gICAgICAgIH0gPSBhd2FpdCBheGlvcy5nZXQoJy9fX3JlYWN0LXN0YXRpY19fL2dldE1lc3NhZ2VQb3J0JylcbiAgICAgICAgY29uc3Qgc29ja2V0ID0gaW8oYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fWApXG4gICAgICAgIHNvY2tldC5vbignY29ubmVjdCcsICgpID0+IHtcbiAgICAgICAgICAvLyBEbyBub3RoaW5nXG4gICAgICAgIH0pXG4gICAgICAgIHNvY2tldC5vbignbWVzc2FnZScsICh7IHR5cGUgfSkgPT4ge1xuICAgICAgICAgIGlmICh0eXBlID09PSAncmVsb2FkQ2xpZW50RGF0YScpIHtcbiAgICAgICAgICAgIHJlbG9hZENsaWVudERhdGEoKVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAnUmVhY3QtU3RhdGljIGRhdGEgaG90LWxvYWRlciB3ZWJzb2NrZXQgZW5jb3VudGVyZWQgdGhlIGZvbGxvd2luZyBlcnJvcjonXG4gICAgICAgIClcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpXG4gICAgICB9XG4gICAgfVxuICAgIHJ1bigpXG4gIH1cblxuICBpZiAocHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX0RJU0FCTEVfUFJFTE9BRCA9PT0gJ2ZhbHNlJykge1xuICAgIHN0YXJ0UHJlbG9hZGVyKClcbiAgfVxufVxuXG5mdW5jdGlvbiBzdGFydFByZWxvYWRlcigpIHtcbiAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBjb25zdCBydW4gPSAoKSA9PiB7XG4gICAgICBjb25zdCBlbHMgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhJykpXG4gICAgICBlbHMuZm9yRWFjaChlbCA9PiB7XG4gICAgICAgIGNvbnN0IGhyZWYgPSBlbC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKVxuICAgICAgICBjb25zdCBzaG91bGRQcmVmZXRjaCA9ICEoZWwuZ2V0QXR0cmlidXRlKCdwcmVmZXRjaCcpID09PSAnZmFsc2UnKVxuICAgICAgICBpZiAoaHJlZiAmJiBzaG91bGRQcmVmZXRjaCkge1xuICAgICAgICAgIG9uVmlzaWJsZShlbCwgKCkgPT4gcHJlZmV0Y2goaHJlZikpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuXG4gICAgc2V0SW50ZXJ2YWwocnVuLCBOdW1iZXIocHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX1BSRUxPQURfUE9MTF9JTlRFUlZBTCkpXG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVsb2FkQ2xpZW50RGF0YSgpIHtcbiAgY29uc29sZS5sb2coJ1JlYWN0IFN0YXRpYzogUmVsb2FkaW5nIERhdGEuLi4nKVxuICAvLyBEZWxldGUgYWxsIGNhY2hlZCBkYXRhXG4gIDtbXG4gICAgcm91dGVJbmZvQnlQYXRoLFxuICAgIHNoYXJlZERhdGFCeUhhc2gsXG4gICAgcm91dGVFcnJvckJ5UGF0aCxcbiAgICBpbmZsaWdodFJvdXRlSW5mbyxcbiAgICBpbmZsaWdodFByb3BIYXNoZXMsXG4gIF0uZm9yRWFjaChwYXJ0ID0+IHtcbiAgICBPYmplY3Qua2V5cyhwYXJ0KS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICBkZWxldGUgcGFydFtrZXldXG4gICAgfSlcbiAgfSlcblxuICAvLyBQcmVmZXRjaCB0aGUgY3VycmVudCByb3V0ZSdzIGRhdGEgYmVmb3JlIHlvdSByZWxvYWQgcm91dGVzXG4gIGF3YWl0IHByZWZldGNoKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSlcblxuICBvblJlbG9hZENsaWVudERhdGEubGlzdGVuZXJzLmZvckVhY2goZm4gPT4gZm4oKSlcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFJvdXRlSW5mbyhwYXRoLCB7IHByaW9yaXR5IH0gPSB7fSkge1xuICBwYXRoID0gZ2V0Um91dGVQYXRoKHBhdGgpXG5cbiAgLy8gQ2hlY2sgaWYgd2Ugc2hvdWxkIGZldGNoIFJvdXRlRGF0YSBmb3IgdGhpcyB1cmwgZXQgYWxsLlxuICBpZiAoIWlzUHJlZmV0Y2hhYmxlUm91dGUocGF0aCkpIHtcbiAgICByZXR1cm5cbiAgfVxuXG4gIC8vIENoZWNrIHRoZSBjYWNoZSBmaXJzdFxuICBpZiAocm91dGVJbmZvQnlQYXRoW3BhdGhdKSB7XG4gICAgcmV0dXJuIHJvdXRlSW5mb0J5UGF0aFtwYXRoXVxuICB9XG5cbiAgLy8gQ2hlY2sgZm9yIGFuIGVycm9yIG9yIG5vbi1leGlzdGVudCBzdGF0aWMgcm91dGVcbiAgaWYgKHJvdXRlRXJyb3JCeVBhdGhbcGF0aF0pIHtcbiAgICByZXR1cm5cbiAgfVxuXG4gIGxldCByb3V0ZUluZm9cblxuICB0cnkge1xuICAgIGlmIChwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gICAgICAvLyBJbiBkZXYsIHJlcXVlc3QgZnJvbSB0aGUgd2VicGFjayBkZXYgc2VydmVyXG4gICAgICBpZiAoIWluZmxpZ2h0Um91dGVJbmZvW3BhdGhdKSB7XG4gICAgICAgIGluZmxpZ2h0Um91dGVJbmZvW3BhdGhdID0gYXhpb3MuZ2V0KFxuICAgICAgICAgIGAvX19yZWFjdC1zdGF0aWNfXy9yb3V0ZUluZm8vJHtwYXRoID09PSAnLycgPyAnJyA6IHBhdGh9YFxuICAgICAgICApXG4gICAgICB9XG4gICAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGluZmxpZ2h0Um91dGVJbmZvW3BhdGhdXG4gICAgICByb3V0ZUluZm8gPSBkYXRhXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEluIHByb2R1Y3Rpb24sIGZldGNoIHRoZSBKU09OIGZpbGVcbiAgICAgIC8vIEZpbmQgdGhlIGxvY2F0aW9uIG9mIHRoZSByb3V0ZUluZm8uanNvbiBmaWxlXG4gICAgICBjb25zdCByb3V0ZUluZm9Sb290ID1cbiAgICAgICAgKHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19ESVNBQkxFX1JPVVRFX1BSRUZJWElORyA9PT0gJ3RydWUnXG4gICAgICAgICAgPyBwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfU0lURV9ST09UXG4gICAgICAgICAgOiBwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfUFVCTElDX1BBVEgpIHx8ICcvJ1xuXG4gICAgICBjb25zdCBnZXRQYXRoID0gYCR7cm91dGVJbmZvUm9vdH0ke3BhdGhKb2luKHBhdGgsICdyb3V0ZUluZm8uanNvbicpfWBcblxuICAgICAgLy8gSWYgdGhpcyBpcyBhIHByaW9yaXR5IGNhbGwgYnlwYXNzIHRoZSBxdWV1ZVxuICAgICAgaWYgKHByaW9yaXR5KSB7XG4gICAgICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXhpb3MuZ2V0KGdldFBhdGgpXG4gICAgICAgIHJvdXRlSW5mbyA9IGRhdGFcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE90aGVyd2lzZSwgYWRkIGl0IHRvIHRoZSBxdWV1ZVxuICAgICAgICBpZiAoIWluZmxpZ2h0Um91dGVJbmZvW3BhdGhdKSB7XG4gICAgICAgICAgaW5mbGlnaHRSb3V0ZUluZm9bcGF0aF0gPSByZXF1ZXN0UG9vbC5hZGQoKCkgPT4gYXhpb3MuZ2V0KGdldFBhdGgpKVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgaW5mbGlnaHRSb3V0ZUluZm9bcGF0aF1cbiAgICAgICAgcm91dGVJbmZvID0gZGF0YVxuICAgICAgfVxuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgLy8gSWYgdGhlcmUgd2FzIGFuIGVycm9yLCBtYXJrIHRoZSBwYXRoIGFzIGVycm9yZWRcbiAgICByb3V0ZUVycm9yQnlQYXRoW3BhdGhdID0gdHJ1ZVxuICAgIC8vIFVubGVzcyB3ZSBhbHJlYWR5IGZldGNoZWQgdGhlIDQwNCBwYWdlLFxuICAgIC8vIHRyeSB0byBsb2FkIGluZm8gZm9yIHRoZSA0MDQgcGFnZVxuICAgIGlmICghcm91dGVJbmZvQnlQYXRoWyc0MDQnXSAmJiAhcm91dGVFcnJvckJ5UGF0aFsnNDA0J10pIHtcbiAgICAgIGdldFJvdXRlSW5mbygnNDA0JywgeyBwcmlvcml0eSB9KVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgcmV0dXJuXG4gIH1cbiAgaWYgKCFwcmlvcml0eSkge1xuICAgIGRlbGV0ZSBpbmZsaWdodFJvdXRlSW5mb1twYXRoXVxuICB9XG4gIGlmICh0eXBlb2Ygcm91dGVJbmZvICE9PSAnb2JqZWN0JyB8fCAhcm91dGVJbmZvLnBhdGgpIHtcbiAgICAvLyByb3V0ZUluZm8gbXVzdCBoYXZlIHJldHVybmVkIDIwMCwgYnV0IGlzIG5vdCBhY3R1YWxseVxuICAgIC8vIGEgcm91dGVJbmZvIG9iamVjdC4gTWFyayBpdCBhcyBhbiBlcnJvciBhbmQgbW92ZSBvbiBzaWxlbnRseVxuICAgIHJvdXRlRXJyb3JCeVBhdGhbcGF0aF0gPSB0cnVlXG4gIH0gZWxzZSB7XG4gICAgcm91dGVJbmZvQnlQYXRoW3BhdGhdID0gcm91dGVJbmZvXG4gIH1cbiAgcmV0dXJuIHJvdXRlSW5mb0J5UGF0aFtwYXRoXVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJlZmV0Y2hEYXRhKHBhdGgsIHsgcHJpb3JpdHkgfSA9IHt9KSB7XG4gIC8vIEdldCByb3V0ZSBpbmZvIHNvIHdlIGNhbiBjaGVjayBpZiBwYXRoIGhhcyBhbnkgZGF0YVxuICBjb25zdCByb3V0ZUluZm8gPSBhd2FpdCBnZXRSb3V0ZUluZm8ocGF0aCwgeyBwcmlvcml0eSB9KVxuXG4gIC8vIE5vdCBhIHN0YXRpYyByb3V0ZT8gQmFpbCBvdXQuXG4gIGlmICghcm91dGVJbmZvKSB7XG4gICAgcmV0dXJuXG4gIH1cblxuICAvLyBEZWZlciB0byB0aGUgY2FjaGUgZmlyc3QuIEluIGRldiBtb2RlLCB0aGlzIHNob3VsZCBhbHJlYWR5IGJlIGF2YWlsYWJsZSBmcm9tXG4gIC8vIHRoZSBjYWxsIHRvIGdldFJvdXRlSW5mb1xuICBpZiAocm91dGVJbmZvLnNoYXJlZERhdGEpIHtcbiAgICByZXR1cm4gZ2V0RnVsbFJvdXRlRGF0YShyb3V0ZUluZm8pXG4gIH1cblxuICAvLyBSZXF1ZXN0IGFuZCBidWlsZCB0aGUgcHJvcHMgb25lIGJ5IG9uZVxuICByb3V0ZUluZm8uc2hhcmVkRGF0YSA9IHt9XG5cbiAgLy8gUmVxdWVzdCB0aGUgdGVtcGxhdGUgYW5kIGxvb3Agb3ZlciB0aGUgcm91dGVJbmZvLnNoYXJlZEhhc2hlc0J5UHJvcCwgcmVxdWVzdGluZyBlYWNoIHByb3BcbiAgYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgT2JqZWN0LmtleXMocm91dGVJbmZvLnNoYXJlZEhhc2hlc0J5UHJvcCkubWFwKGFzeW5jIGtleSA9PiB7XG4gICAgICBjb25zdCBoYXNoID0gcm91dGVJbmZvLnNoYXJlZEhhc2hlc0J5UHJvcFtrZXldXG5cbiAgICAgIC8vIENoZWNrIHRoZSBzaGFyZWREYXRhQnlIYXNoIGZpcnN0XG4gICAgICBpZiAoIXNoYXJlZERhdGFCeUhhc2hbaGFzaF0pIHtcbiAgICAgICAgLy8gUmV1c2UgcmVxdWVzdCBmb3IgZHVwbGljYXRlIGluZmxpZ2h0IHJlcXVlc3RzXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3Qgc3RhdGljRGF0YVBhdGggPSBwYXRoSm9pbihcbiAgICAgICAgICAgIHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19BU1NFVFNfUEFUSCxcbiAgICAgICAgICAgIGBzdGF0aWNEYXRhLyR7aGFzaH0uanNvbmBcbiAgICAgICAgICApXG4gICAgICAgICAgY29uc3QgYWJzb2x1dGVTdGF0aWNEYXRhUGF0aCA9IG1ha2VQYXRoQWJzb2x1dGUoc3RhdGljRGF0YVBhdGgpXG5cbiAgICAgICAgICAvLyBJZiBwcmlvcml0eSwgZ2V0IGl0IGltbWVkaWF0ZWx5XG4gICAgICAgICAgaWYgKHByaW9yaXR5KSB7XG4gICAgICAgICAgICBjb25zdCB7IGRhdGE6IHByb3AgfSA9IGF3YWl0IGF4aW9zLmdldChhYnNvbHV0ZVN0YXRpY0RhdGFQYXRoKVxuICAgICAgICAgICAgc2hhcmVkRGF0YUJ5SGFzaFtoYXNoXSA9IHByb3BcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gTm9uIHByaW9yaXR5LCBzaGFyZSBpbmZsaWdodCByZXF1ZXN0cyBhbmQgdXNlIHBvb2xcbiAgICAgICAgICAgIGlmICghaW5mbGlnaHRQcm9wSGFzaGVzW2hhc2hdKSB7XG4gICAgICAgICAgICAgIGluZmxpZ2h0UHJvcEhhc2hlc1toYXNoXSA9IHJlcXVlc3RQb29sLmFkZCgoKSA9PlxuICAgICAgICAgICAgICAgIGF4aW9zLmdldChhYnNvbHV0ZVN0YXRpY0RhdGFQYXRoKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IGRhdGE6IHByb3AgfSA9IGF3YWl0IGluZmxpZ2h0UHJvcEhhc2hlc1toYXNoXVxuICAgICAgICAgICAgLy8gUGxhY2UgaXQgaW4gdGhlIGNhY2hlXG4gICAgICAgICAgICBzaGFyZWREYXRhQnlIYXNoW2hhc2hdID0gcHJvcFxuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAnRXJyb3I6IFRoZXJlIHdhcyBhbiBlcnJvciByZXRyaWV2aW5nIGEgcHJvcCBmb3IgdGhpcyByb3V0ZSEgaGFzaElEOicsXG4gICAgICAgICAgICBoYXNoXG4gICAgICAgICAgKVxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKVxuICAgICAgICB9XG4gICAgICAgIGlmICghcHJpb3JpdHkpIHtcbiAgICAgICAgICBkZWxldGUgaW5mbGlnaHRQcm9wSGFzaGVzW2hhc2hdXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gT3RoZXJ3aXNlLCBqdXN0IHNldCBpdCBhcyB0aGUga2V5XG4gICAgICByb3V0ZUluZm8uc2hhcmVkRGF0YVtrZXldID0gc2hhcmVkRGF0YUJ5SGFzaFtoYXNoXVxuICAgIH0pXG4gIClcblxuICByZXR1cm4gZ2V0RnVsbFJvdXRlRGF0YShyb3V0ZUluZm8pXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcmVmZXRjaFRlbXBsYXRlKHBhdGgsIHsgcHJpb3JpdHkgfSA9IHt9KSB7XG4gIC8vIENsZWFuIHRoZSBwYXRoXG4gIHBhdGggPSBnZXRSb3V0ZVBhdGgocGF0aClcbiAgLy8gR2V0IHJvdXRlIGluZm8gc28gd2UgY2FuIGNoZWNrIGlmIHBhdGggaGFzIGFueSBkYXRhXG4gIGNvbnN0IHJvdXRlSW5mbyA9IGF3YWl0IGdldFJvdXRlSW5mbyhwYXRoLCB7IHByaW9yaXR5IH0pXG5cbiAgaWYgKHJvdXRlSW5mbykge1xuICAgIC8vIE1ha2Ugc3VyZSB0byB1c2UgdGhlIHBhdGggYXMgZGVmaW5lZCBpbiB0aGUgcm91dGVJbmZvIG9iamVjdCBoZXJlLlxuICAgIC8vIFRoaXMgd2lsbCBtYWtlIHN1cmUgNDA0IHJvdXRlIGluZm8gcmV0dXJuZWQgZnJvbSBnZXRSb3V0ZUluZm8gaXMgaGFuZGxlZCBjb3JyZWN0bHkuXG4gICAgcmVnaXN0ZXJUZW1wbGF0ZUZvclBhdGgocm91dGVJbmZvLnBhdGgsIHJvdXRlSW5mby50ZW1wbGF0ZSlcbiAgfVxuXG4gIC8vIFByZWxvYWQgdGhlIHRlbXBsYXRlIGlmIGF2YWlsYWJsZVxuICBjb25zdCBUZW1wbGF0ZSA9IHRlbXBsYXRlc0J5UGF0aFtwYXRoXVxuICBpZiAoIVRlbXBsYXRlKSB7XG4gICAgLy8gSWYgbm8gdGVtcGxhdGUgd2FzIGZvdW5kLCBtYXJrIGl0IHdpdGggYW4gZXJyb3JcbiAgICB0ZW1wbGF0ZUVycm9yQnlQYXRoW3BhdGhdID0gdHJ1ZVxuICAgIHJldHVyblxuICB9XG5cbiAgLy8gSWYgd2UgZGlkbid0IG5vIHJvdXRlIGluZm8gd2FzIHJldHVybiwgdGhlcmUgaXMgbm90aGluZyBtb3JlIHRvIGRvIGhlcmVcbiAgaWYgKCFyb3V0ZUluZm8pIHtcbiAgICByZXR1cm4gVGVtcGxhdGVcbiAgfVxuXG4gIGlmICghcm91dGVJbmZvLnRlbXBsYXRlTG9hZGVkICYmIFRlbXBsYXRlLnByZWxvYWQpIHtcbiAgICBpZiAocHJpb3JpdHkpIHtcbiAgICAgIGF3YWl0IFRlbXBsYXRlLnByZWxvYWQoKVxuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCByZXF1ZXN0UG9vbC5hZGQoKCkgPT4gVGVtcGxhdGUucHJlbG9hZCgpKVxuICAgIH1cbiAgICByb3V0ZUluZm8udGVtcGxhdGVMb2FkZWQgPSB0cnVlXG4gIH1cbiAgcmV0dXJuIFRlbXBsYXRlXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcmVmZXRjaChwYXRoLCBvcHRpb25zID0ge30pIHtcbiAgLy8gQ2xlYW4gdGhlIHBhdGhcbiAgcGF0aCA9IGdldFJvdXRlUGF0aChwYXRoKVxuXG4gIGNvbnN0IHsgdHlwZSB9ID0gb3B0aW9uc1xuXG4gIC8vIElmIGl0J3MgcHJpb3JpdHksIHdlIHN0b3AgdGhlIHF1ZXVlIHRlbXBvcmFyaWx5XG4gIGlmIChvcHRpb25zLnByaW9yaXR5KSB7XG4gICAgcmVxdWVzdFBvb2wuc3RvcCgpXG4gIH1cblxuICBsZXQgZGF0YVxuICBpZiAodHlwZSA9PT0gJ2RhdGEnKSB7XG4gICAgZGF0YSA9IGF3YWl0IHByZWZldGNoRGF0YShwYXRoLCBvcHRpb25zKVxuICB9IGVsc2UgaWYgKHR5cGUgPT09ICd0ZW1wbGF0ZScpIHtcbiAgICBhd2FpdCBwcmVmZXRjaFRlbXBsYXRlKHBhdGgsIG9wdGlvbnMpXG4gIH0gZWxzZSB7XG4gICAgO1tkYXRhXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgIHByZWZldGNoRGF0YShwYXRoLCBvcHRpb25zKSxcbiAgICAgIHByZWZldGNoVGVtcGxhdGUocGF0aCwgb3B0aW9ucyksXG4gICAgXSlcbiAgfVxuXG4gIC8vIElmIGl0IHdhcyBwcmlvcml0eSwgc3RhcnQgdGhlIHF1ZXVlIGFnYWluXG4gIGlmIChvcHRpb25zLnByaW9yaXR5KSB7XG4gICAgcmVxdWVzdFBvb2wuc3RhcnQoKVxuICB9XG5cbiAgcmV0dXJuIGRhdGFcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzUHJlZmV0Y2hhYmxlUm91dGUocGF0aCkge1xuICAvLyB3aGVuIHJlbmRlcmluZyBzdGF0aWMgcGFnZXMgd2UgZG9udCBuZWVkIHRoaXMgYXQgYWxsXG4gIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICBpZiAoXG4gICAgcHJlZmV0Y2hFeGNsdWRlcy5zb21lKGV4Y2x1ZGUgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBleGNsdWRlID09PSAnc3RyaW5nJyAmJiBwYXRoLnN0YXJ0c1dpdGgoZXhjbHVkZSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2YgZXhjbHVkZSA9PT0gJ29iamVjdCcgJiYgZXhjbHVkZS50ZXN0KHBhdGgpKSB7XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9KVxuICApIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIGNvbnN0IHsgbG9jYXRpb24gfSA9IGRvY3VtZW50XG4gIGxldCBsaW5rXG5cbiAgdHJ5IHtcbiAgICBsaW5rID0gbmV3IFVSTChwYXRoLCBsb2NhdGlvbi5ocmVmKVxuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gUmV0dXJuIGZhbHNlIG9uIGludmFsaWQgVVJMc1xuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgLy8gaWYgdGhlIGhvc3RuYW1lL3BvcnQvcHJvdG9jb2wgZG9lc24ndCBtYXRjaCBpdHMgbm90IGEgcm91dGUgbGlua1xuICBpZiAobG9jYXRpb24uaG9zdCAhPT0gbGluay5ob3N0IHx8IGxvY2F0aW9uLnByb3RvY29sICE9PSBsaW5rLnByb3RvY29sKSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICAvLyBkZW55IGFsbCBmaWxlcyB3aXRoIGV4dGVuc2lvbiBvdGhlciB0aGFuIC5odG1sXG4gIGlmIChsaW5rLnBhdGhuYW1lLmluY2x1ZGVzKCcuJykgJiYgIWxpbmsucGF0aG5hbWUuaW5jbHVkZXMoJy5odG1sJykpIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIHJldHVybiB0cnVlXG59XG5cbmV4cG9ydCBjb25zdCBwbHVnaW5zID0ge1xuICBSb290OiBDb21wID0+IHtcbiAgICBjb25zdCBob29rcyA9IGdldEhvb2tzKHBsdWdpbkhvb2tzLCAnUm9vdCcpXG4gICAgcmV0dXJuIHJlZHVjZUhvb2tzKGhvb2tzLCB7IHN5bmM6IHRydWUgfSkoQ29tcClcbiAgfSxcbiAgUm91dGVzOiBDb21wID0+IHtcbiAgICBjb25zdCBob29rcyA9IGdldEhvb2tzKHBsdWdpbkhvb2tzLCAnUm91dGVzJylcbiAgICByZXR1cm4gcmVkdWNlSG9va3MoaG9va3MsIHsgc3luYzogdHJ1ZSB9KShDb21wKVxuICB9LFxufVxuIl19