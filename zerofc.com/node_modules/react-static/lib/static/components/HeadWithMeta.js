"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.makeHeadWithMeta = makeHeadWithMeta;
exports.InlineStyle = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _react = _interopRequireDefault(require("react"));

var _utils = require("../../utils");

var _plugins = _interopRequireDefault(require("../plugins"));

//
// import packagejson from '../../../package.json'
// const { version } = packagejson
var REGEX_FOR_STYLE_TAG = /<style>|<\/style>/gi;

var InlineStyle = function InlineStyle(_ref) {
  var clientCss = _ref.clientCss;
  return _react.default.createElement("style", {
    key: "clientCss",
    type: "text/css",
    dangerouslySetInnerHTML: {
      __html: clientCss.toString().replace(REGEX_FOR_STYLE_TAG, '')
    }
  });
};

exports.InlineStyle = InlineStyle;

function makeHeadWithMeta(_x) {
  return _makeHeadWithMeta.apply(this, arguments);
}

function _makeHeadWithMeta() {
  _makeHeadWithMeta = (0, _asyncToGenerator2.default)(
  /*#__PURE__*/
  _regenerator.default.mark(function _callee(state) {
    var head, route, clientScripts, config, clientStyleSheets, clientCss, pluginHeads;
    return _regenerator.default.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            head = state.head, route = state.route, clientScripts = state.clientScripts, config = state.config, clientStyleSheets = state.clientStyleSheets, clientCss = state.clientCss;
            _context.next = 3;
            return _plugins.default.headElements([], state);

          case 3:
            pluginHeads = _context.sent;
            return _context.abrupt("return", function (_ref2) {
              var children = _ref2.children,
                  rest = (0, _objectWithoutProperties2.default)(_ref2, ["children"]);
              var renderLinkCSS = !route.redirect && !config.inlineCss;
              var useHelmetTitle = head.title && head.title[0] && head.title[0].props.children !== '';

              var childrenArray = _react.default.Children.toArray(children);

              if (useHelmetTitle) {
                head.title[0] = _react.default.cloneElement(head.title[0], {
                  key: 'title'
                });
                childrenArray = childrenArray.filter(function (child) {
                  if (child.type === 'title') {
                    // Filter out the title of the Document in static.config.js
                    // if there is a helmet title on this route
                    return false;
                  }

                  return true;
                });
              }

              var childrenCSS = childrenArray.filter(function (child) {
                if (child.type === 'link' && child.props && child.props.rel === 'stylesheet') {
                  return true;
                } else if (child.type === 'style') {
                  return true;
                }

                return false;
              });
              var childrenJS = childrenArray.filter(function (child) {
                return child.type === 'script';
              });
              childrenArray = childrenArray.filter(function (child) {
                if (child.type === 'link' && child.props && child.props.rel === 'stylesheet') {
                  return false;
                } else if (child.type === 'style') {
                  return false;
                } else if (child.type === 'script') {
                  return false;
                }

                return true;
              });
              return _react.default.createElement("head", rest, _react.default.createElement("meta", {
                name: "generator",
                content: "React Static"
              }), head.base, useHelmetTitle && head.title, head.meta, childrenJS, !route.redirect && clientScripts.map(function (script) {
                return _react.default.createElement("link", {
                  key: "clientScript_".concat(script),
                  rel: "preload",
                  as: "script",
                  href: (0, _utils.makePathAbsolute)((0, _utils.pathJoin)(process.env.REACT_STATIC_ASSETS_PATH, script))
                });
              }), childrenCSS, renderLinkCSS && clientStyleSheets.reduce(function (memo, styleSheet) {
                var href = (0, _utils.makePathAbsolute)((0, _utils.pathJoin)(process.env.REACT_STATIC_ASSETS_PATH, styleSheet));
                return [].concat((0, _toConsumableArray2.default)(memo), [_react.default.createElement("link", {
                  key: "clientStyleSheetPreload_".concat(styleSheet),
                  rel: "preload",
                  as: "style",
                  href: href
                }), _react.default.createElement("link", {
                  key: "clientStyleSheet_".concat(styleSheet),
                  rel: "stylesheet",
                  href: href
                })]);
              }, []), head.link, head.noscript, head.script, config.inlineCss && _react.default.createElement(InlineStyle, {
                clientCss: clientCss
              }), head.style, pluginHeads, childrenArray);
            });

          case 5:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  }));
  return _makeHeadWithMeta.apply(this, arguments);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zdGF0aWMvY29tcG9uZW50cy9IZWFkV2l0aE1ldGEuanMiXSwibmFtZXMiOlsiUkVHRVhfRk9SX1NUWUxFX1RBRyIsIklubGluZVN0eWxlIiwiY2xpZW50Q3NzIiwiX19odG1sIiwidG9TdHJpbmciLCJyZXBsYWNlIiwibWFrZUhlYWRXaXRoTWV0YSIsInN0YXRlIiwiaGVhZCIsInJvdXRlIiwiY2xpZW50U2NyaXB0cyIsImNvbmZpZyIsImNsaWVudFN0eWxlU2hlZXRzIiwicGx1Z2lucyIsImhlYWRFbGVtZW50cyIsInBsdWdpbkhlYWRzIiwiY2hpbGRyZW4iLCJyZXN0IiwicmVuZGVyTGlua0NTUyIsInJlZGlyZWN0IiwiaW5saW5lQ3NzIiwidXNlSGVsbWV0VGl0bGUiLCJ0aXRsZSIsInByb3BzIiwiY2hpbGRyZW5BcnJheSIsIlJlYWN0IiwiQ2hpbGRyZW4iLCJ0b0FycmF5IiwiY2xvbmVFbGVtZW50Iiwia2V5IiwiZmlsdGVyIiwiY2hpbGQiLCJ0eXBlIiwiY2hpbGRyZW5DU1MiLCJyZWwiLCJjaGlsZHJlbkpTIiwiYmFzZSIsIm1ldGEiLCJtYXAiLCJzY3JpcHQiLCJwcm9jZXNzIiwiZW52IiwiUkVBQ1RfU1RBVElDX0FTU0VUU19QQVRIIiwicmVkdWNlIiwibWVtbyIsInN0eWxlU2hlZXQiLCJocmVmIiwibGluayIsIm5vc2NyaXB0Iiwic3R5bGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBOztBQUNBOztBQUZBO0FBR0E7QUFFQTtBQUVBLElBQU1BLG1CQUFtQixHQUFHLHFCQUE1Qjs7QUFFTyxJQUFNQyxXQUFXLEdBQUcsU0FBZEEsV0FBYztBQUFBLE1BQUdDLFNBQUgsUUFBR0EsU0FBSDtBQUFBLFNBQ3pCO0FBQ0UsSUFBQSxHQUFHLEVBQUMsV0FETjtBQUVFLElBQUEsSUFBSSxFQUFDLFVBRlA7QUFHRSxJQUFBLHVCQUF1QixFQUFFO0FBQ3ZCQyxNQUFBQSxNQUFNLEVBQUVELFNBQVMs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QUFHLDZCQUFzQkQsVUFBdEIsQ0FETDtBQUVFLGtCQUFBLEdBQUcsRUFBQyxZQUZOO0FBR0Usa0JBQUEsSUFBSSxFQUFFQztBQUhSLGtCQVJGO0FBY0QsZUFuQkQsRUFtQkcsRUFuQkgsQ0FuQkosRUF1Q0d0QyxJQUFJLENBQUN1QyxJQXZDUixFQXdDR3ZDLElBQUksQ0FBQ3dDLFFBeENSLEVBeUNHeEMsSUFBSSxDQUFDK0IsTUF6Q1IsRUEwQ0c1QixNQUFNLENBQUNTLFNBQVAsSUFBb0IsNkJBQUMsV0FBRDtBQUFhLGdCQUFBLFNBQVMsRUFBRWxCO0FBQXhCLGdCQTFDdkIsRUEyQ0dNLElBQUksQ0FBQ3lDLEtBM0NSLEVBNENHbEMsV0E1Q0gsRUE2Q0dTLGFBN0NILENBREY7QUFpREQsYUE5R0k7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCdcbi8vXG5pbXBvcnQgeyBwYXRoSm9pbiwgbWFrZVBhdGhBYnNvbHV0ZSB9IGZyb20gJy4uLy4uL3V0aWxzJ1xuaW1wb3J0IHBsdWdpbnMgZnJvbSAnLi4vcGx1Z2lucydcbi8vIGltcG9ydCBwYWNrYWdlanNvbiBmcm9tICcuLi8uLi8uLi9wYWNrYWdlLmpzb24nXG5cbi8vIGNvbnN0IHsgdmVyc2lvbiB9ID0gcGFja2FnZWpzb25cblxuY29uc3QgUkVHRVhfRk9SX1NUWUxFX1RBRyA9IC88c3R5bGU+fDxcXC9zdHlsZT4vZ2lcblxuZXhwb3J0IGNvbnN0IElubGluZVN0eWxlID0gKHsgY2xpZW50Q3NzIH0pID0+IChcbiAgPHN0eWxlXG4gICAga2V5PVwiY2xpZW50Q3NzXCJcbiAgICB0eXBlPVwidGV4dC9jc3NcIlxuICAgIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MPXt7XG4gICAgICBfX2h0bWw6IGNsaWVudENzcy50b1N0cmluZygpLnJlcGxhY2UoUkVHRVhfRk9SX1NUWUxFX1RBRywgJycpLFxuICAgIH19XG4gIC8+XG4pXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtYWtlSGVhZFdpdGhNZXRhKHN0YXRlKSB7XG4gIGNvbnN0IHtcbiAgICBoZWFkLFxuICAgIHJvdXRlLFxuICAgIGNsaWVudFNjcmlwdHMsXG4gICAgY29uZmlnLFxuICAgIGNsaWVudFN0eWxlU2hlZXRzLFxuICAgIGNsaWVudENzcyxcbiAgfSA9IHN0YXRlXG5cbiAgY29uc3QgcGx1Z2luSGVhZHMgPSBhd2FpdCBwbHVnaW5zLmhlYWRFbGVtZW50cyhbXSwgc3RhdGUpXG5cbiAgcmV0dXJuICh7IGNoaWxkcmVuLCAuLi5yZXN0IH0pID0+IHtcbiAgICBjb25zdCByZW5kZXJMaW5rQ1NTID0gIXJvdXRlLnJlZGlyZWN0ICYmICFjb25maWcuaW5saW5lQ3NzXG5cbiAgICBjb25zdCB1c2VIZWxtZXRUaXRsZSA9XG4gICAgICBoZWFkLnRpdGxlICYmIGhlYWQudGl0bGVbMF0gJiYgaGVhZC50aXRsZVswXS5wcm9wcy5jaGlsZHJlbiAhPT0gJydcblxuICAgIGxldCBjaGlsZHJlbkFycmF5ID0gUmVhY3QuQ2hpbGRyZW4udG9BcnJheShjaGlsZHJlbilcblxuICAgIGlmICh1c2VIZWxtZXRUaXRsZSkge1xuICAgICAgaGVhZC50aXRsZVswXSA9IFJlYWN0LmNsb25lRWxlbWVudChoZWFkLnRpdGxlWzBdLCB7IGtleTogJ3RpdGxlJyB9KVxuICAgICAgY2hpbGRyZW5BcnJheSA9IGNoaWxkcmVuQXJyYXkuZmlsdGVyKGNoaWxkID0+IHtcbiAgICAgICAgaWYgKGNoaWxkLnR5cGUgPT09ICd0aXRsZScpIHtcbiAgICAgICAgICAvLyBGaWx0ZXIgb3V0IHRoZSB0aXRsZSBvZiB0aGUgRG9jdW1lbnQgaW4gc3RhdGljLmNvbmZpZy5qc1xuICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIGEgaGVsbWV0IHRpdGxlIG9uIHRoaXMgcm91dGVcbiAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBjb25zdCBjaGlsZHJlbkNTUyA9IGNoaWxkcmVuQXJyYXkuZmlsdGVyKGNoaWxkID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgY2hpbGQudHlwZSA9PT0gJ2xpbmsnICYmXG4gICAgICAgIGNoaWxkLnByb3BzICYmXG4gICAgICAgIGNoaWxkLnByb3BzLnJlbCA9PT0gJ3N0eWxlc2hlZXQnXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH0gZWxzZSBpZiAoY2hpbGQudHlwZSA9PT0gJ3N0eWxlJykge1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfSlcblxuICAgIGNvbnN0IGNoaWxkcmVuSlMgPSBjaGlsZHJlbkFycmF5LmZpbHRlcihjaGlsZCA9PiBjaGlsZC50eXBlID09PSAnc2NyaXB0JylcbiAgICBjaGlsZHJlbkFycmF5ID0gY2hpbGRyZW5BcnJheS5maWx0ZXIoY2hpbGQgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBjaGlsZC50eXBlID09PSAnbGluaycgJiZcbiAgICAgICAgY2hpbGQucHJvcHMgJiZcbiAgICAgICAgY2hpbGQucHJvcHMucmVsID09PSAnc3R5bGVzaGVldCdcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH0gZWxzZSBpZiAoY2hpbGQudHlwZSA9PT0gJ3N0eWxlJykge1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH0gZWxzZSBpZiAoY2hpbGQudHlwZSA9PT0gJ3NjcmlwdCcpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0pXG5cbiAgICByZXR1cm4gKFxuICAgICAgPGhlYWQgey4uLnJlc3R9PlxuICAgICAgICA8bWV0YSBuYW1lPVwiZ2VuZXJhdG9yXCIgY29udGVudD1cIlJlYWN0IFN0YXRpY1wiIC8+XG4gICAgICAgIHtoZWFkLmJhc2V9XG4gICAgICAgIHt1c2VIZWxtZXRUaXRsZSAmJiBoZWFkLnRpdGxlfVxuICAgICAgICB7aGVhZC5tZXRhfVxuICAgICAgICB7Y2hpbGRyZW5KU31cbiAgICAgICAgeyFyb3V0ZS5yZWRpcmVjdCAmJlxuICAgICAgICAgIGNsaWVudFNjcmlwdHMubWFwKHNjcmlwdCA9PiAoXG4gICAgICAgICAgICA8bGlua1xuICAgICAgICAgICAgICBrZXk9e2BjbGllbnRTY3JpcHRfJHtzY3JpcHR9YH1cbiAgICAgICAgICAgICAgcmVsPVwicHJlbG9hZFwiXG4gICAgICAgICAgICAgIGFzPVwic2NyaXB0XCJcbiAgICAgICAgICAgICAgaHJlZj17bWFrZVBhdGhBYnNvbHV0ZShcbiAgICAgICAgICAgICAgICBwYXRoSm9pbihwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfQVNTRVRTX1BBVEgsIHNjcmlwdClcbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKSl9XG4gICAgICAgIHtjaGlsZHJlbkNTU31cbiAgICAgICAge3JlbmRlckxpbmtDU1MgJiZcbiAgICAgICAgICBjbGllbnRTdHlsZVNoZWV0cy5yZWR1Y2UoKG1lbW8sIHN0eWxlU2hlZXQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGhyZWYgPSBtYWtlUGF0aEFic29sdXRlKFxuICAgICAgICAgICAgICBwYXRoSm9pbihwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfQVNTRVRTX1BBVEgsIHN0eWxlU2hlZXQpXG4gICAgICAgICAgICApXG5cbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgIC4uLm1lbW8sXG4gICAgICAgICAgICAgIDxsaW5rXG4gICAgICAgICAgICAgICAga2V5PXtgY2xpZW50U3R5bGVTaGVldFByZWxvYWRfJHtzdHlsZVNoZWV0fWB9XG4gICAgICAgICAgICAgICAgcmVsPVwicHJlbG9hZFwiXG4gICAgICAgICAgICAgICAgYXM9XCJzdHlsZVwiXG4gICAgICAgICAgICAgICAgaHJlZj17aHJlZn1cbiAgICAgICAgICAgICAgLz4sXG4gICAgICAgICAgICAgIDxsaW5rXG4gICAgICAgICAgICAgICAga2V5PXtgY2xpZW50U3R5bGVTaGVldF8ke3N0eWxlU2hlZXR9YH1cbiAgICAgICAgICAgICAgICByZWw9XCJzdHlsZXNoZWV0XCJcbiAgICAgICAgICAgICAgICBocmVmPXtocmVmfVxuICAgICAgICAgICAgICAvPixcbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9LCBbXSl9XG4gICAgICAgIHtoZWFkLmxpbmt9XG4gICAgICAgIHtoZWFkLm5vc2NyaXB0fVxuICAgICAgICB7aGVhZC5zY3JpcHR9XG4gICAgICAgIHtjb25maWcuaW5saW5lQ3NzICYmIDxJbmxpbmVTdHlsZSBjbGllbnRDc3M9e2NsaWVudENzc30gLz59XG4gICAgICAgIHtoZWFkLnN0eWxlfVxuICAgICAgICB7cGx1Z2luSGVhZHN9XG4gICAgICAgIHtjaGlsZHJlbkFycmF5fVxuICAgICAgPC9oZWFkPlxuICAgIClcbiAgfVxufVxuIl19