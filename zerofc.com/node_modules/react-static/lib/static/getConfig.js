"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = getConfig;
exports.buildConfig = buildConfig;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _path = _interopRequireDefault(require("path"));

var _chokidar = _interopRequireDefault(require("chokidar"));

var _resolveFrom = _interopRequireDefault(require("resolve-from"));

var _fsExtra = _interopRequireDefault(require("fs-extra"));

var _utils = require("../utils");

var _plugins = _interopRequireWildcard(require("./plugins"));

/* eslint-disable import/no-dynamic-require */
//
// the default static.config.js location
var defaultConfig = {};
var DEFAULT_NAME_FOR_STATIC_CONFIG_FILE = 'static.config';

var DEFAULT_PATH_FOR_STATIC_CONFIG = _path.default.resolve(_path.default.join(process.cwd(), DEFAULT_NAME_FOR_STATIC_CONFIG_FILE));

var DEFAULT_ROUTES = [{
  path: '/'
}];
var DEFAULT_ENTRY = 'index';
var DEFAULT_EXTENSIONS = ['.js', '.jsx']; // Retrieves the static.config.js from the current project directory

function getConfig(state) {
  var callback = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (config) {
    if (state.debug) {
      console.log('getConfig():');
      console.log(state);
    }

    return config;
  };
  var configPath = state.configPath || DEFAULT_PATH_FOR_STATIC_CONFIG;
  state = (0, _objectSpread2.default)({}, state, {
    originalConfig: configPath
  });
  var resolvedPath = resolveModule(configPath);
  var noConfig = configPath === DEFAULT_PATH_FOR_STATIC_CONFIG && !resolvedPath;

  if (noConfig) {
    // last
    state = buildConfig(state, defaultConfig);
    return callback(state);
  }

  state = buildConfigFromPath(state, resolvedPath || configPath);

  if (state.stage === 'dev') {
    _chokidar.default.watch(resolvedPath, {
      ignoreInitial: true
    }).on('all',
    /*#__PURE__*/
    (0, _asyncToGenerator2.default)(
    /*#__PURE__*/
    _regenerator.default.mark(function _callee() {
      return _regenerator.default.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              console.log('');
              console.log("Updating static.config.js");
              state = buildConfigFromPath(state, resolvedPath);
              callback(state);

            case 4:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    })));
  }

  return callback(state);
}

function buildConfigFromPath(state, configPath) {
  delete require.cache[configPath];

  var config = require(configPath).default;

  return buildConfig(state, config);
}

function buildConfig(state) {
  var config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  // path defaults
  config.paths = (0, _objectSpread2.default)({
    root: _path.default.resolve(process.cwd()),
    src: 'src',
    dist: 'dist',
    temp: 'tmp',
    buildArtifacts: 'artifacts',
    devDist: 'tmp/dev-server',
    public: 'public',
    plugins: 'plugins',
    pages: 'src/pages',
    nodeModules: 'node_modules',
    assets: ''
  }, config.paths || {}); // Use the root to resolve all other relative paths

  var resolvePath = function resolvePath(relativePath) {
    return _path.default.resolve(config.paths.root, relativePath);
  }; // Resolve all paths


  var DIST = process.env.REACT_STATIC_ENV === 'development' ? resolvePath(config.paths.devDist || config.paths.dist) : resolvePath(config.paths.dist);

  var ASSETS = _path.default.resolve(DIST, config.paths.assets);

  var paths = {
    ROOT: config.paths.root,
    SRC: resolvePath(config.paths.src),
    DIST: DIST,
    ASSETS: ASSETS,
    PLUGINS: resolvePath(config.paths.plugins),
    TEMP: resolvePath(config.paths.temp),
    ARTIFACTS: resolvePath(config.paths.buildArtifacts),
    PUBLIC: resolvePath(config.paths.public),
    NODE_MODULES: resolvePath(config.paths.nodeModules),
    EXCLUDE_MODULES: config.paths.excludeResolvedModules || resolvePath(config.paths.nodeModules),
    PACKAGE: resolvePath('package.json'),
    HTML_TEMPLATE: _path.default.join(DIST, 'index.html'),
    STATIC_DATA: _path.default.join(ASSETS, 'staticData')
  };
  var siteRoot = '';
  var basePath = '';

  if (process.env.REACT_STATIC_ENV === 'development') {
    basePath = (0, _utils.cleanSlashes)(config.devBasePath);
  } else if (state.staging) {
    siteRoot = (0, _utils.cutPathToRoot)(config.stagingSiteRoot || '/', '$1');
    basePath = (0, _utils.cleanSlashes)(config.stagingBasePath);
  } else {
    siteRoot = (0, _utils.cutPathToRoot)(config.siteRoot, '$1');
    basePath = (0, _utils.cleanSlashes)(config.basePath);
  }

  var publicPath = "".concat((0, _utils.cleanSlashes)("".concat(siteRoot, "/").concat(basePath)), "/");
  var assetsPath = (0, _utils.cleanSlashes)(config.assetsPath || paths.assets);

  if (assetsPath && !(0, _utils.isAbsoluteUrl)(assetsPath)) {
    assetsPath = "/".concat((0, _utils.cleanSlashes)("".concat(basePath, "/").concat(assetsPath)), "/");
  } // Add the project root as a plugin. This allows the dev
  // to use the plugin api directory in their project if they want


  var plugins = [].concat((0, _toConsumableArray2.default)(config.plugins || []), [paths.ROOT]);

  var DEFAULT_ENTRY_PATH = _path.default.join(paths.SRC, DEFAULT_ENTRY); // Defaults


  config = (0, _objectSpread2.default)({
    // Defaults
    entry: resolveModule(DEFAULT_ENTRY_PATH, config) || "".concat(DEFAULT_ENTRY_PATH, ".js"),
    getSiteData: function getSiteData() {
      return {};
    },
    prefetchRate: 5,
    maxThreads: Infinity,
    disableRoutePrefixing: false,
    outputFileRate: 100,
    extensions: DEFAULT_EXTENSIONS,
    getRoutes: function () {
      var _getRoutes = (0, _asyncToGenerator2.default)(
      /*#__PURE__*/
      _regenerator.default.mark(function _callee2() {
        return _regenerator.default.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                return _context2.abrupt("return", DEFAULT_ROUTES);

              case 1:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2);
      }));

      function getRoutes() {
        return _getRoutes.apply(this, arguments);
      }

      return getRoutes;
    }(),
    minLoadTime: 200,
    disablePreload: false,
    disableRuntime: false,
    preloadPollInterval: 300,
    productionSourceMaps: false
  }, config, {
    // Materialized Overrides
    devServer: (0, _objectSpread2.default)({
      host: 'http://localhost',
      port: 3000
    }, config.devServer || {}),
    plugins: plugins,
    paths: paths,
    babelExcludes: config.babelExcludes || [],
    siteRoot: siteRoot,
    basePath: basePath,
    publicPath: publicPath,
    assetsPath: assetsPath,
    extractCssChunks: config.extractCssChunks || false,
    inlineCss: config.inlineCss || false
  });
  config.terser = config.terser || {};
  config.terser.terserOptions = config.terser.terserOptions || {};
  config.terser.terserOptions.mangle = config.terser.terserOptions.mangle || {};
  config.terser.terserOptions.parse = config.terser.terserOptions.parse || {};
  config.terser.terserOptions.compress = config.terser.terserOptions.compress || {};
  config.terser.terserOptions.output = config.terser.terserOptions.output || {}; // Set env variables to be used client side

  process.env.REACT_STATIC_MIN_LOAD_TIME = config.minLoadTime;
  process.env.REACT_STATIC_PREFETCH_RATE = config.prefetchRate;
  process.env.REACT_STATIC_DISABLE_ROUTE_PREFIXING = config.disableRoutePrefixing;
  process.env.REACT_STATIC_DISABLE_PRELOAD = config.disablePreload;
  process.env.REACT_STATIC_DISABLE_RUNTIME = config.disableRuntime;
  process.env.REACT_STATIC_PRELOAD_POLL_INTERVAL = config.preloadPollIntervalw;
  process.env.REACT_STATIC_TEMPLATES_PATH = _path.default.join(paths.ARTIFACTS, 'react-static-templates.js');
  process.env.REACT_STATIC_PLUGINS_PATH = _path.default.join(paths.ARTIFACTS, 'react-static-browser-plugins.js');
  process.env.REACT_STATIC_UNIVERSAL_PATH = require.resolve('react-universal-component');

  var resolvePlugin = function resolvePlugin(originalLocation) {
    var options = {};

    if (Array.isArray(originalLocation)) {
      options = originalLocation[1] || {};
      originalLocation = originalLocation[0];
    }

    var location = [function () {
      // Absolute require
      try {
        var found = require.resolve(originalLocation);

        return found.includes('.') ? _path.default.resolve(found, '../') : found;
      } catch (err) {//
      }
    }, function () {
      // Absolute
      if (_fsExtra.default.pathExistsSync(originalLocation)) {
        return originalLocation;
      }
    }, function () {
      // Plugins Dir
      var found = _path.default.resolve(paths.PLUGINS, originalLocation);

      if (_fsExtra.default.pathExistsSync(found)) {
        return found;
      }
    }, function () {
      // Plugins Dir require
      try {
        var found = (0, _resolveFrom.default)(paths.PLUGINS, originalLocation);
        return found.includes('.') ? _path.default.resolve(found, '../') : found;
      } catch (err) {//
      }
    }, function () {
      // CWD
      var found = _path.default.resolve(process.cwd(), originalLocation);

      if (_fsExtra.default.pathExistsSync(found)) {
        return found;
      }
    }, function () {
      // CWD require
      try {
        var found = (0, _resolveFrom.default)(process.cwd(), originalLocation);
        return found.includes('.') ? _path.default.resolve(found, '../') : found;
      } catch (err) {//
      }
    }, function () {
      if (process.env.NODE_ENV === 'test') {
        // Allow plugins to be mocked
        return 'mock-plugin';
      }
    }].reduce(function (prev, curr) {
      return prev || curr();
    }, null); // TODO: We have to do this because we don't have a good mock for process.cwd() :(

    if (!location) {
      throw new Error("Could not find a plugin directory for the plugin: \"".concat(originalLocation, "\". We must bail!"));
    }

    var nodeLocation = resolveModule(_path.default.join(location, 'node.api'), config);
    var browserLocation = resolveModule(_path.default.join(location, 'browser.api'), config);

    var buildPluginHooks = function buildPluginHooks() {
      return {};
    };

    try {
      // Get the hooks for the node api
      if (nodeLocation) {
        buildPluginHooks = require(nodeLocation).default;
      } else if (originalLocation !== paths.ROOT && !browserLocation) {
        throw new Error("Could not find a valid node.api.js or browser.api.js plugin file in \"".concat(location, "\""));
      }

      var resolvedPlugin = {
        location: location,
        nodeLocation: nodeLocation,
        browserLocation: browserLocation,
        options: options,
        hooks: buildPluginHooks(options) || {}
      };
      (0, _plugins.validatePlugin)(resolvedPlugin); // Recursively resolve plugins

      if (resolvedPlugin.plugins) {
        resolvedPlugin.plugins = resolvedPlugin.plugins.map(resolvePlugin);
      }

      return resolvedPlugin;
    } catch (err) {
      console.error("The following error occurred in the plugin: \"".concat(originalLocation, "\""));
      throw err;
    }
  };

  state = (0, _objectSpread2.default)({}, state, {
    plugins: config.plugins.map(resolvePlugin),
    config: config
  });
  return _plugins.default.afterGetConfig(state);
}

function resolveModule(path, config) {
  try {
    // Load any module extension that is supported by Node (.js, .mjs, .node, etc),
    // or that have been registered via Node require hooks (.jsx, .ts, etc)
    return require.resolve(path);
  } catch (_unused) {
    // Fallback to the extensions that have been registered with Babel
    var extensions = config && config.extensions || DEFAULT_EXTENSIONS;
    return extensions.map(function (ext) {
      return path + ext;
    }).find(_fsExtra.default.pathExistsSync);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdGF0aWMvZ2V0Q29uZmlnLmpzIl0sIm5hbWVzIjpbImRlZmF1bHRDb25maWciLCJERUZBVUxUX05BTUVfRk9SX1NUQVRJQ19DT05GSUdfRklMRSIsIkRFRkFVTFRfUEFUSF9GT1JfU1RBVElDX0NPTkZJRyIsIm5vZGVQYXRoIiwicmVzb2x2ZSIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiREVGQVVMVF9ST1VURVMiLCJwYXRoIiwiREVGQVVMVF9FTlRSWSIsIkRFRkFVTFRfRVhURU5TSU9OUyIsImdldENvbmZpZyIsInN0YXRlIiwiY2FsbGJhY2siLCJjb25maWciLCJkZWJ1ZyIsImNvbnNvbGUiLCJsb2ciLCJjb25maWdQYXRoIiwib3JpZ2luYWxDb25maWciLCJyZXNvbHZlZFBhdGgiLCJyZXNvbHZlTW9kdWxlIiwibm9Db25maWciLCJidWlsZENvbmZpZyIsImJ1aWxkQ29uZmlnRnJvbVBhdGgiLCJzdGFnZSIsImNob2tpZGFyIiwid2F0Y2giLCJpZ25vcmVJbml0aWFsIiwib24iLCJyZXF1aXJlIiwiY2FjaGUiLCJkZWZhdWx0IiwicGF0aHMiLCJyb290Iiwic3JjIiwiZGlzdCIsInRlbXAiLCJidWlsZEFydGlmYWN0cyIsImRldkRpc3QiLCJwdWJsaWMiLCJwbHVnaW5zIiwicGFnZXMiLCJub2RlTW9kdWxlcyIsImFzc2V0cyIsInJlc29sdmVQYXRoIiwicmVsYXRpdmVQYXRoIiwiRElTVCIsImVudiIsIlJFQUNUX1NUQVRJQ19FTlYiLCJBU1NFVFMiLCJST09UIiwiU1JDIiwiUExVR0lOUyIsIlRFTVAiLCJBUlRJRkFDVFMiLCJQVUJMSUMiLCJOT0RFX01PRFVMRVMiLCJFWENMVURFX01PRFVMRVMiLCJleGNsdWRlUmVzb2x2ZWRNb2R1bGVzIiwiUEFDS0FHRSIsIkhUTUxfVEVNUExBVEUiLCJTVEFUSUNfREFUQSIsInNpdGVSb290IiwiYmFzZVBhdGgiLCJkZXZCYXNlUGF0aCIsInN0YWdpbmciLCJzdGFnaW5nU2l0ZVJvb3QiLCJzdGFnaW5nQmFzZVBhdGgiLCJwdWJsaWNQYXRoIiwiYXNzZXRzUGF0aCIsIkRFRkFVTFRfRU5UUllfUEFUSCIsImVudHJ5IiwiZ2V0U2l0ZURhdGEiLCJwcmVmZXRjaFJhdGUiLCJtYXhUaHJlYWRzIiwiSW5maW5pdHkiLCJkaXNhYmxlUm91dGVQcmVmaXhpbmciLCJvdXRwdXRGaWxlUmF0ZSIsImV4dGVuc2lvbnMiLCJnZXRSb3V0ZXMiLCJtaW5Mb2FkVGltZSIsImRpc2FibGVQcmVsb2FkIiwiZGlzYWJsZVJ1bnRpbWUiLCJwcmVsb2FkUG9sbEludGVydmFsIiwicHJvZHVjdGlvblNvdXJjZU1hcHMiLCJkZXZTZXJ2ZXIiLCJob3N0IiwicG9ydCIsImJhYmVsRXhjbHVkZXMiLCJleHRyYWN0Q3NzQ2h1bmtzIiwiaW5saW5lQ3NzIiwidGVyc2VyIiwidGVyc2VyT3B0aW9ucyIsIm1hbmdsZSIsInBhcnNlIiwiY29tcHJlc3MiLCJvdXRwdXQiLCJSRUFDVF9TVEFUSUNfTUlOX0xPQURfVElNRSIsIlJFQUNUX1NUQVRJQ19QUkVGRVRDSF9SQVRFIiwiUkVBQ1RfU1RBVElDX0RJU0FCTEVfUk9VVEVfUFJFRklYSU5HIiwiUkVBQ1RfU1RBVElDX0RJU0FCTEVfUFJFTE9BRCIsIlJFQUNUX1NUQVRJQ19ESVNBQkxFX1JVTlRJTUUiLCJSRUFDVF9TVEFUSUNfUFJFTE9BRF9QT0xMX0lOVEVSVkFMIiwicHJlbG9hZFBvbGxJbnRlcnZhbHciLCJSRUFDVF9TVEFUSUNfVEVNUExBVEVTX1BBVEgiLCJSRUFDVF9TVEFUSUNfUExVR0lOU19QQVRIIiwiUkVBQ1RfU1RBVElDX1VOSVZFUlNBTF9QQVRIIiwicmVzb2x2ZVBsdWdpbiIsIm9yaWdpbmFsTG9jYXRpb24iLCJvcHRpb25zIiwiQXJyYXkiLCJpc0FycmF5IiwibG9jYXRpb24iLCJmb3VuZCIsImluY2x1ZGVzIiwiZXJyIiwiZnMiLCJwYXRoRXhpc3RzU3luYyIsIk5PREVfRU5WIiwicmVkdWNlIiwicHJldiIsImN1cnIiLCJFcnJvciIsIm5vZGVMb2NhdGlvbiIsImJyb3dzZXJMb2NhdGlvbiIsImJ1aWxkUGx1Z2luSG9va3MiLCJyZXNvbHZlZFBsdWdpbiIsImhvb2tzIiwibWFwIiwiZXJyb3IiLCJjb3JlUGx1Z2lucyIsImFmdGVyR2V0Q29uZmlnIiwiZXh0IiwiZmluZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFSQTtBQU1BO0FBSUE7QUFDQSxJQUFNQSxhQUFhLEdBQUcsRUFBdEI7QUFDQSxJQUFNQyxtQ0FBbUMsR0FBRyxlQUE1Qzs7QUFDQSxJQUFNQyw4QkFBOEIsR0FBR0MsY0FBU0MsT0FBVCxDQUNyQ0QsY0FBU0UsSUFBVCxDQUFjQyxPQUFPLENBQUNDLEdBQVIsRUFBZCxFQUE2Qk4sbUNBQTdCLENBRHFDLENBQXZDOztBQUdBLElBQU1PLGNBQWMsR0FBRyxDQUFDO0FBQUVDLEVBQUFBLElBQUksRUFBRTtBQUFSLENBQUQsQ0FBdkI7QUFDQSxJQUFNQyxhQUFhLEdBQUcsT0FBdEI7QUFDQSxJQUFNQyxrQkFBa0IsR0FBRyxDQUFDLEtBQUQsRUFBUSxNQUFSLENBQTNCLEMsQ0FFQTs7QUFDZSxTQUFTQyxTQUFULENBQ2JDLEtBRGEsRUFTYjtBQUFBLE1BUEFDLFFBT0EsdUVBUFcsVUFBQUMsTUFBTSxFQUFJO0FBQ25CLFFBQUlGLEtBQUssQ0FBQ0csS0FBVixFQUFpQjtBQUNmQyxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxjQUFaO0FBQ0FELE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZTCxLQUFaO0FBQ0Q7O0FBQ0QsV0FBT0UsTUFBUDtBQUNELEdBQ0Q7QUFDQSxNQUFNSSxVQUFVLEdBQUdOLEtBQUssQ0FBQ00sVUFBTixJQUFvQmpCLDhCQUF2QztBQUVBVyxFQUFBQSxLQUFLLG1DQUNBQSxLQURBO0FBRUhPLElBQUFBLGNBQWMsRUFBRUQ7QUFGYixJQUFMO0FBS0EsTUFBTUUsWUFBWSxHQUFHQyxhQUFhLENBQUNILFVBQUQsQ0FBbEM7QUFFQSxN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LENBQWdCSyxJQUFoQixDQUFQO0FBQ0QsR0FKRCxDQUlFLGdCQUFNO0FBQ047QUFDQSxRQUFNdUUsVUFBVSxHQUFJakUsTUFBTSxJQUFJQSxNQUFNLENBQUNpRSxVQUFsQixJQUFpQ3JFLGtCQUFwRDtBQUNBLFdBQU9xRSxVQUFVLENBQUNrRCxHQUFYLENBQWUsVUFBQUksR0FBRztBQUFBLGFBQUk3SCxJQUFJLEdBQUc2SCxHQUFYO0FBQUEsS0FBbEIsRUFBa0NDLElBQWxDLENBQXVDakIsaUJBQUdDLGNBQTFDLENBQVA7QUFDRDtBQUNGIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgaW1wb3J0L25vLWR5bmFtaWMtcmVxdWlyZSAqL1xuXG5pbXBvcnQgbm9kZVBhdGggZnJvbSAncGF0aCdcbmltcG9ydCBjaG9raWRhciBmcm9tICdjaG9raWRhcidcbmltcG9ydCByZXNvbHZlRnJvbSBmcm9tICdyZXNvbHZlLWZyb20nXG5pbXBvcnQgZnMgZnJvbSAnZnMtZXh0cmEnXG4vL1xuaW1wb3J0IHsgY2xlYW5TbGFzaGVzLCBjdXRQYXRoVG9Sb290LCBpc0Fic29sdXRlVXJsIH0gZnJvbSAnLi4vdXRpbHMnXG5pbXBvcnQgY29yZVBsdWdpbnMsIHsgdmFsaWRhdGVQbHVnaW4gfSBmcm9tICcuL3BsdWdpbnMnXG5cbi8vIHRoZSBkZWZhdWx0IHN0YXRpYy5jb25maWcuanMgbG9jYXRpb25cbmNvbnN0IGRlZmF1bHRDb25maWcgPSB7fVxuY29uc3QgREVGQVVMVF9OQU1FX0ZPUl9TVEFUSUNfQ09ORklHX0ZJTEUgPSAnc3RhdGljLmNvbmZpZydcbmNvbnN0IERFRkFVTFRfUEFUSF9GT1JfU1RBVElDX0NPTkZJRyA9IG5vZGVQYXRoLnJlc29sdmUoXG4gIG5vZGVQYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgREVGQVVMVF9OQU1FX0ZPUl9TVEFUSUNfQ09ORklHX0ZJTEUpXG4pXG5jb25zdCBERUZBVUxUX1JPVVRFUyA9IFt7IHBhdGg6ICcvJyB9XVxuY29uc3QgREVGQVVMVF9FTlRSWSA9ICdpbmRleCdcbmNvbnN0IERFRkFVTFRfRVhURU5TSU9OUyA9IFsnLmpzJywgJy5qc3gnXVxuXG4vLyBSZXRyaWV2ZXMgdGhlIHN0YXRpYy5jb25maWcuanMgZnJvbSB0aGUgY3VycmVudCBwcm9qZWN0IGRpcmVjdG9yeVxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZ2V0Q29uZmlnKFxuICBzdGF0ZSxcbiAgY2FsbGJhY2sgPSBjb25maWcgPT4ge1xuICAgIGlmIChzdGF0ZS5kZWJ1Zykge1xuICAgICAgY29uc29sZS5sb2coJ2dldENvbmZpZygpOicpXG4gICAgICBjb25zb2xlLmxvZyhzdGF0ZSlcbiAgICB9XG4gICAgcmV0dXJuIGNvbmZpZ1xuICB9XG4pIHtcbiAgY29uc3QgY29uZmlnUGF0aCA9IHN0YXRlLmNvbmZpZ1BhdGggfHwgREVGQVVMVF9QQVRIX0ZPUl9TVEFUSUNfQ09ORklHXG5cbiAgc3RhdGUgPSB7XG4gICAgLi4uc3RhdGUsXG4gICAgb3JpZ2luYWxDb25maWc6IGNvbmZpZ1BhdGgsXG4gIH1cblxuICBjb25zdCByZXNvbHZlZFBhdGggPSByZXNvbHZlTW9kdWxlKGNvbmZpZ1BhdGgpXG5cbiAgY29uc3Qgbm9Db25maWcgPVxuICAgIGNvbmZpZ1BhdGggPT09IERFRkFVTFRfUEFUSF9GT1JfU1RBVElDX0NPTkZJRyAmJiAhcmVzb2x2ZWRQYXRoXG5cbiAgaWYgKG5vQ29uZmlnKSB7XG4gICAgLy8gbGFzdFxuICAgIHN0YXRlID0gYnVpbGRDb25maWcoc3RhdGUsIGRlZmF1bHRDb25maWcpXG4gICAgcmV0dXJuIGNhbGxiYWNrKHN0YXRlKVxuICB9XG5cbiAgc3RhdGUgPSBidWlsZENvbmZpZ0Zyb21QYXRoKHN0YXRlLCByZXNvbHZlZFBhdGggfHwgY29uZmlnUGF0aClcblxuICBpZiAoc3RhdGUuc3RhZ2UgPT09ICdkZXYnKSB7XG4gICAgY2hva2lkYXJcbiAgICAgIC53YXRjaChyZXNvbHZlZFBhdGgsIHtcbiAgICAgICAgaWdub3JlSW5pdGlhbDogdHJ1ZSxcbiAgICAgIH0pXG4gICAgICAub24oJ2FsbCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJycpXG4gICAgICAgIGNvbnNvbGUubG9nKGBVcGRhdGluZyBzdGF0aWMuY29uZmlnLmpzYClcbiAgICAgICAgc3RhdGUgPSBidWlsZENvbmZpZ0Zyb21QYXRoKHN0YXRlLCByZXNvbHZlZFBhdGgpXG4gICAgICAgIGNhbGxiYWNrKHN0YXRlKVxuICAgICAgfSlcbiAgfVxuXG4gIHJldHVybiBjYWxsYmFjayhzdGF0ZSlcbn1cblxuZnVuY3Rpb24gYnVpbGRDb25maWdGcm9tUGF0aChzdGF0ZSwgY29uZmlnUGF0aCkge1xuICBkZWxldGUgcmVxdWlyZS5jYWNoZVtjb25maWdQYXRoXVxuICBjb25zdCBjb25maWcgPSByZXF1aXJlKGNvbmZpZ1BhdGgpLmRlZmF1bHRcbiAgcmV0dXJuIGJ1aWxkQ29uZmlnKHN0YXRlLCBjb25maWcpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBidWlsZENvbmZpZyhzdGF0ZSwgY29uZmlnID0ge30pIHtcbiAgLy8gcGF0aCBkZWZhdWx0c1xuICBjb25maWcucGF0aHMgPSB7XG4gICAgcm9vdDogbm9kZVBhdGgucmVzb2x2ZShwcm9jZXNzLmN3ZCgpKSxcbiAgICBzcmM6ICdzcmMnLFxuICAgIGRpc3Q6ICdkaXN0JyxcbiAgICB0ZW1wOiAndG1wJyxcbiAgICBidWlsZEFydGlmYWN0czogJ2FydGlmYWN0cycsXG4gICAgZGV2RGlzdDogJ3RtcC9kZXYtc2VydmVyJyxcbiAgICBwdWJsaWM6ICdwdWJsaWMnLFxuICAgIHBsdWdpbnM6ICdwbHVnaW5zJyxcbiAgICBwYWdlczogJ3NyYy9wYWdlcycsXG4gICAgbm9kZU1vZHVsZXM6ICdub2RlX21vZHVsZXMnLFxuICAgIGFzc2V0czogJycsXG4gICAgLi4uKGNvbmZpZy5wYXRocyB8fCB7fSksXG4gIH1cblxuICAvLyBVc2UgdGhlIHJvb3QgdG8gcmVzb2x2ZSBhbGwgb3RoZXIgcmVsYXRpdmUgcGF0aHNcbiAgY29uc3QgcmVzb2x2ZVBhdGggPSByZWxhdGl2ZVBhdGggPT5cbiAgICBub2RlUGF0aC5yZXNvbHZlKGNvbmZpZy5wYXRocy5yb290LCByZWxhdGl2ZVBhdGgpXG5cbiAgLy8gUmVzb2x2ZSBhbGwgcGF0aHNcbiAgY29uc3QgRElTVCA9XG4gICAgcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX0VOViA9PT0gJ2RldmVsb3BtZW50J1xuICAgICAgPyByZXNvbHZlUGF0aChjb25maWcucGF0aHMuZGV2RGlzdCB8fCBjb25maWcucGF0aHMuZGlzdClcbiAgICAgIDogcmVzb2x2ZVBhdGgoY29uZmlnLnBhdGhzLmRpc3QpXG5cbiAgY29uc3QgQVNTRVRTID0gbm9kZVBhdGgucmVzb2x2ZShESVNULCBjb25maWcucGF0aHMuYXNzZXRzKVxuXG4gIGNvbnN0IHBhdGhzID0ge1xuICAgIFJPT1Q6IGNvbmZpZy5wYXRocy5yb290LFxuICAgIFNSQzogcmVzb2x2ZVBhdGgoY29uZmlnLnBhdGhzLnNyYyksXG4gICAgRElTVCxcbiAgICBBU1NFVFMsXG4gICAgUExVR0lOUzogcmVzb2x2ZVBhdGgoY29uZmlnLnBhdGhzLnBsdWdpbnMpLFxuICAgIFRFTVA6IHJlc29sdmVQYXRoKGNvbmZpZy5wYXRocy50ZW1wKSxcbiAgICBBUlRJRkFDVFM6IHJlc29sdmVQYXRoKGNvbmZpZy5wYXRocy5idWlsZEFydGlmYWN0cyksXG4gICAgUFVCTElDOiByZXNvbHZlUGF0aChjb25maWcucGF0aHMucHVibGljKSxcbiAgICBOT0RFX01PRFVMRVM6IHJlc29sdmVQYXRoKGNvbmZpZy5wYXRocy5ub2RlTW9kdWxlcyksXG4gICAgRVhDTFVERV9NT0RVTEVTOlxuICAgICAgY29uZmlnLnBhdGhzLmV4Y2x1ZGVSZXNvbHZlZE1vZHVsZXMgfHxcbiAgICAgIHJlc29sdmVQYXRoKGNvbmZpZy5wYXRocy5ub2RlTW9kdWxlcyksXG4gICAgUEFDS0FHRTogcmVzb2x2ZVBhdGgoJ3BhY2thZ2UuanNvbicpLFxuICAgIEhUTUxfVEVNUExBVEU6IG5vZGVQYXRoLmpvaW4oRElTVCwgJ2luZGV4Lmh0bWwnKSxcbiAgICBTVEFUSUNfREFUQTogbm9kZVBhdGguam9pbihBU1NFVFMsICdzdGF0aWNEYXRhJyksXG4gIH1cblxuICBsZXQgc2l0ZVJvb3QgPSAnJ1xuICBsZXQgYmFzZVBhdGggPSAnJ1xuXG4gIGlmIChwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gICAgYmFzZVBhdGggPSBjbGVhblNsYXNoZXMoY29uZmlnLmRldkJhc2VQYXRoKVxuICB9IGVsc2UgaWYgKHN0YXRlLnN0YWdpbmcpIHtcbiAgICBzaXRlUm9vdCA9IGN1dFBhdGhUb1Jvb3QoY29uZmlnLnN0YWdpbmdTaXRlUm9vdCB8fCAnLycsICckMScpXG4gICAgYmFzZVBhdGggPSBjbGVhblNsYXNoZXMoY29uZmlnLnN0YWdpbmdCYXNlUGF0aClcbiAgfSBlbHNlIHtcbiAgICBzaXRlUm9vdCA9IGN1dFBhdGhUb1Jvb3QoY29uZmlnLnNpdGVSb290LCAnJDEnKVxuICAgIGJhc2VQYXRoID0gY2xlYW5TbGFzaGVzKGNvbmZpZy5iYXNlUGF0aClcbiAgfVxuXG4gIGNvbnN0IHB1YmxpY1BhdGggPSBgJHtjbGVhblNsYXNoZXMoYCR7c2l0ZVJvb3R9LyR7YmFzZVBhdGh9YCl9L2BcblxuICBsZXQgYXNzZXRzUGF0aCA9IGNsZWFuU2xhc2hlcyhjb25maWcuYXNzZXRzUGF0aCB8fCBwYXRocy5hc3NldHMpXG4gIGlmIChhc3NldHNQYXRoICYmICFpc0Fic29sdXRlVXJsKGFzc2V0c1BhdGgpKSB7XG4gICAgYXNzZXRzUGF0aCA9IGAvJHtjbGVhblNsYXNoZXMoYCR7YmFzZVBhdGh9LyR7YXNzZXRzUGF0aH1gKX0vYFxuICB9XG5cbiAgLy8gQWRkIHRoZSBwcm9qZWN0IHJvb3QgYXMgYSBwbHVnaW4uIFRoaXMgYWxsb3dzIHRoZSBkZXZcbiAgLy8gdG8gdXNlIHRoZSBwbHVnaW4gYXBpIGRpcmVjdG9yeSBpbiB0aGVpciBwcm9qZWN0IGlmIHRoZXkgd2FudFxuICBjb25zdCBwbHVnaW5zID0gWy4uLihjb25maWcucGx1Z2lucyB8fCBbXSksIHBhdGhzLlJPT1RdXG5cbiAgY29uc3QgREVGQVVMVF9FTlRSWV9QQVRIID0gbm9kZVBhdGguam9pbihwYXRocy5TUkMsIERFRkFVTFRfRU5UUlkpXG5cbiAgLy8gRGVmYXVsdHNcbiAgY29uZmlnID0ge1xuICAgIC8vIERlZmF1bHRzXG4gICAgZW50cnk6XG4gICAgICByZXNvbHZlTW9kdWxlKERFRkFVTFRfRU5UUllfUEFUSCwgY29uZmlnKSB8fCBgJHtERUZBVUxUX0VOVFJZX1BBVEh9LmpzYCxcbiAgICBnZXRTaXRlRGF0YTogKCkgPT4gKHt9KSxcbiAgICBwcmVmZXRjaFJhdGU6IDUsXG4gICAgbWF4VGhyZWFkczogSW5maW5pdHksXG4gICAgZGlzYWJsZVJvdXRlUHJlZml4aW5nOiBmYWxzZSxcbiAgICBvdXRwdXRGaWxlUmF0ZTogMTAwLFxuICAgIGV4dGVuc2lvbnM6IERFRkFVTFRfRVhURU5TSU9OUyxcbiAgICBnZXRSb3V0ZXM6IGFzeW5jICgpID0+IERFRkFVTFRfUk9VVEVTLFxuICAgIG1pbkxvYWRUaW1lOiAyMDAsXG4gICAgZGlzYWJsZVByZWxvYWQ6IGZhbHNlLFxuICAgIGRpc2FibGVSdW50aW1lOiBmYWxzZSxcbiAgICBwcmVsb2FkUG9sbEludGVydmFsOiAzMDAsXG4gICAgcHJvZHVjdGlvblNvdXJjZU1hcHM6IGZhbHNlLFxuICAgIC8vIENvbmZpZyBPdmVycmlkZXNcbiAgICAuLi5jb25maWcsXG4gICAgLy8gTWF0ZXJpYWxpemVkIE92ZXJyaWRlc1xuICAgIGRldlNlcnZlcjoge1xuICAgICAgaG9zdDogJ2h0dHA6Ly9sb2NhbGhvc3QnLFxuICAgICAgcG9ydDogMzAwMCxcbiAgICAgIC4uLihjb25maWcuZGV2U2VydmVyIHx8IHt9KSxcbiAgICB9LFxuICAgIHBsdWdpbnMsXG4gICAgcGF0aHMsXG4gICAgYmFiZWxFeGNsdWRlczogY29uZmlnLmJhYmVsRXhjbHVkZXMgfHwgW10sXG4gICAgc2l0ZVJvb3QsXG4gICAgYmFzZVBhdGgsXG4gICAgcHVibGljUGF0aCxcbiAgICBhc3NldHNQYXRoLFxuICAgIGV4dHJhY3RDc3NDaHVua3M6IGNvbmZpZy5leHRyYWN0Q3NzQ2h1bmtzIHx8IGZhbHNlLFxuICAgIGlubGluZUNzczogY29uZmlnLmlubGluZUNzcyB8fCBmYWxzZSxcbiAgfVxuXG4gIGNvbmZpZy50ZXJzZXIgPSBjb25maWcudGVyc2VyIHx8IHt9XG4gIGNvbmZpZy50ZXJzZXIudGVyc2VyT3B0aW9ucyA9IGNvbmZpZy50ZXJzZXIudGVyc2VyT3B0aW9ucyB8fCB7fVxuICBjb25maWcudGVyc2VyLnRlcnNlck9wdGlvbnMubWFuZ2xlID0gY29uZmlnLnRlcnNlci50ZXJzZXJPcHRpb25zLm1hbmdsZSB8fCB7fVxuICBjb25maWcudGVyc2VyLnRlcnNlck9wdGlvbnMucGFyc2UgPSBjb25maWcudGVyc2VyLnRlcnNlck9wdGlvbnMucGFyc2UgfHwge31cbiAgY29uZmlnLnRlcnNlci50ZXJzZXJPcHRpb25zLmNvbXByZXNzID1cbiAgICBjb25maWcudGVyc2VyLnRlcnNlck9wdGlvbnMuY29tcHJlc3MgfHwge31cbiAgY29uZmlnLnRlcnNlci50ZXJzZXJPcHRpb25zLm91dHB1dCA9IGNvbmZpZy50ZXJzZXIudGVyc2VyT3B0aW9ucy5vdXRwdXQgfHwge31cblxuICAvLyBTZXQgZW52IHZhcmlhYmxlcyB0byBiZSB1c2VkIGNsaWVudCBzaWRlXG4gIHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19NSU5fTE9BRF9USU1FID0gY29uZmlnLm1pbkxvYWRUaW1lXG4gIHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19QUkVGRVRDSF9SQVRFID0gY29uZmlnLnByZWZldGNoUmF0ZVxuICBwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfRElTQUJMRV9ST1VURV9QUkVGSVhJTkcgPVxuICAgIGNvbmZpZy5kaXNhYmxlUm91dGVQcmVmaXhpbmdcbiAgcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX0RJU0FCTEVfUFJFTE9BRCA9IGNvbmZpZy5kaXNhYmxlUHJlbG9hZFxuICBwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfRElTQUJMRV9SVU5USU1FID0gY29uZmlnLmRpc2FibGVSdW50aW1lXG4gIHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19QUkVMT0FEX1BPTExfSU5URVJWQUwgPSBjb25maWcucHJlbG9hZFBvbGxJbnRlcnZhbHdcblxuICBwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfVEVNUExBVEVTX1BBVEggPSBub2RlUGF0aC5qb2luKFxuICAgIHBhdGhzLkFSVElGQUNUUyxcbiAgICAncmVhY3Qtc3RhdGljLXRlbXBsYXRlcy5qcydcbiAgKVxuICBwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfUExVR0lOU19QQVRIID0gbm9kZVBhdGguam9pbihcbiAgICBwYXRocy5BUlRJRkFDVFMsXG4gICAgJ3JlYWN0LXN0YXRpYy1icm93c2VyLXBsdWdpbnMuanMnXG4gIClcbiAgcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX1VOSVZFUlNBTF9QQVRIID0gcmVxdWlyZS5yZXNvbHZlKFxuICAgICdyZWFjdC11bml2ZXJzYWwtY29tcG9uZW50J1xuICApXG5cbiAgY29uc3QgcmVzb2x2ZVBsdWdpbiA9IG9yaWdpbmFsTG9jYXRpb24gPT4ge1xuICAgIGxldCBvcHRpb25zID0ge31cbiAgICBpZiAoQXJyYXkuaXNBcnJheShvcmlnaW5hbExvY2F0aW9uKSkge1xuICAgICAgb3B0aW9ucyA9IG9yaWdpbmFsTG9jYXRpb25bMV0gfHwge31cbiAgICAgIG9yaWdpbmFsTG9jYXRpb24gPSBvcmlnaW5hbExvY2F0aW9uWzBdXG4gICAgfVxuXG4gICAgY29uc3QgbG9jYXRpb24gPSBbXG4gICAgICAoKSA9PiB7XG4gICAgICAgIC8vIEFic29sdXRlIHJlcXVpcmVcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBmb3VuZCA9IHJlcXVpcmUucmVzb2x2ZShvcmlnaW5hbExvY2F0aW9uKVxuICAgICAgICAgIHJldHVybiBmb3VuZC5pbmNsdWRlcygnLicpID8gbm9kZVBhdGgucmVzb2x2ZShmb3VuZCwgJy4uLycpIDogZm91bmRcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgLy9cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgICgpID0+IHtcbiAgICAgICAgLy8gQWJzb2x1dGVcbiAgICAgICAgaWYgKGZzLnBhdGhFeGlzdHNTeW5jKG9yaWdpbmFsTG9jYXRpb24pKSB7XG4gICAgICAgICAgcmV0dXJuIG9yaWdpbmFsTG9jYXRpb25cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgICgpID0+IHtcbiAgICAgICAgLy8gUGx1Z2lucyBEaXJcbiAgICAgICAgY29uc3QgZm91bmQgPSBub2RlUGF0aC5yZXNvbHZlKHBhdGhzLlBMVUdJTlMsIG9yaWdpbmFsTG9jYXRpb24pXG4gICAgICAgIGlmIChmcy5wYXRoRXhpc3RzU3luYyhmb3VuZCkpIHtcbiAgICAgICAgICByZXR1cm4gZm91bmRcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgICgpID0+IHtcbiAgICAgICAgLy8gUGx1Z2lucyBEaXIgcmVxdWlyZVxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGZvdW5kID0gcmVzb2x2ZUZyb20ocGF0aHMuUExVR0lOUywgb3JpZ2luYWxMb2NhdGlvbilcbiAgICAgICAgICByZXR1cm4gZm91bmQuaW5jbHVkZXMoJy4nKSA/IG5vZGVQYXRoLnJlc29sdmUoZm91bmQsICcuLi8nKSA6IGZvdW5kXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8vXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAoKSA9PiB7XG4gICAgICAgIC8vIENXRFxuICAgICAgICBjb25zdCBmb3VuZCA9IG5vZGVQYXRoLnJlc29sdmUocHJvY2Vzcy5jd2QoKSwgb3JpZ2luYWxMb2NhdGlvbilcbiAgICAgICAgaWYgKGZzLnBhdGhFeGlzdHNTeW5jKGZvdW5kKSkge1xuICAgICAgICAgIHJldHVybiBmb3VuZFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgKCkgPT4ge1xuICAgICAgICAvLyBDV0QgcmVxdWlyZVxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGZvdW5kID0gcmVzb2x2ZUZyb20ocHJvY2Vzcy5jd2QoKSwgb3JpZ2luYWxMb2NhdGlvbilcbiAgICAgICAgICByZXR1cm4gZm91bmQuaW5jbHVkZXMoJy4nKSA/IG5vZGVQYXRoLnJlc29sdmUoZm91bmQsICcuLi8nKSA6IGZvdW5kXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8vXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAoKSA9PiB7XG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Rlc3QnKSB7XG4gICAgICAgICAgLy8gQWxsb3cgcGx1Z2lucyB0byBiZSBtb2NrZWRcbiAgICAgICAgICByZXR1cm4gJ21vY2stcGx1Z2luJ1xuICAgICAgICB9XG4gICAgICB9LFxuICAgIF0ucmVkdWNlKChwcmV2LCBjdXJyKSA9PiBwcmV2IHx8IGN1cnIoKSwgbnVsbClcblxuICAgIC8vIFRPRE86IFdlIGhhdmUgdG8gZG8gdGhpcyBiZWNhdXNlIHdlIGRvbid0IGhhdmUgYSBnb29kIG1vY2sgZm9yIHByb2Nlc3MuY3dkKCkgOihcbiAgICBpZiAoIWxvY2F0aW9uKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBDb3VsZCBub3QgZmluZCBhIHBsdWdpbiBkaXJlY3RvcnkgZm9yIHRoZSBwbHVnaW46IFwiJHtvcmlnaW5hbExvY2F0aW9ufVwiLiBXZSBtdXN0IGJhaWwhYFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IG5vZGVMb2NhdGlvbiA9IHJlc29sdmVNb2R1bGUoXG4gICAgICBub2RlUGF0aC5qb2luKGxvY2F0aW9uLCAnbm9kZS5hcGknKSxcbiAgICAgIGNvbmZpZ1xuICAgIClcbiAgICBjb25zdCBicm93c2VyTG9jYXRpb24gPSByZXNvbHZlTW9kdWxlKFxuICAgICAgbm9kZVBhdGguam9pbihsb2NhdGlvbiwgJ2Jyb3dzZXIuYXBpJyksXG4gICAgICBjb25maWdcbiAgICApXG4gICAgbGV0IGJ1aWxkUGx1Z2luSG9va3MgPSAoKSA9PiAoe30pXG5cbiAgICB0cnkge1xuICAgICAgLy8gR2V0IHRoZSBob29rcyBmb3IgdGhlIG5vZGUgYXBpXG4gICAgICBpZiAobm9kZUxvY2F0aW9uKSB7XG4gICAgICAgIGJ1aWxkUGx1Z2luSG9va3MgPSByZXF1aXJlKG5vZGVMb2NhdGlvbikuZGVmYXVsdFxuICAgICAgfSBlbHNlIGlmIChvcmlnaW5hbExvY2F0aW9uICE9PSBwYXRocy5ST09UICYmICFicm93c2VyTG9jYXRpb24pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBDb3VsZCBub3QgZmluZCBhIHZhbGlkIG5vZGUuYXBpLmpzIG9yIGJyb3dzZXIuYXBpLmpzIHBsdWdpbiBmaWxlIGluIFwiJHtsb2NhdGlvbn1cImBcbiAgICAgICAgKVxuICAgICAgfVxuXG4gICAgICBjb25zdCByZXNvbHZlZFBsdWdpbiA9IHtcbiAgICAgICAgbG9jYXRpb24sXG4gICAgICAgIG5vZGVMb2NhdGlvbixcbiAgICAgICAgYnJvd3NlckxvY2F0aW9uLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICBob29rczogYnVpbGRQbHVnaW5Ib29rcyhvcHRpb25zKSB8fCB7fSxcbiAgICAgIH1cblxuICAgICAgdmFsaWRhdGVQbHVnaW4ocmVzb2x2ZWRQbHVnaW4pXG5cbiAgICAgIC8vIFJlY3Vyc2l2ZWx5IHJlc29sdmUgcGx1Z2luc1xuICAgICAgaWYgKHJlc29sdmVkUGx1Z2luLnBsdWdpbnMpIHtcbiAgICAgICAgcmVzb2x2ZWRQbHVnaW4ucGx1Z2lucyA9IHJlc29sdmVkUGx1Z2luLnBsdWdpbnMubWFwKHJlc29sdmVQbHVnaW4pXG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXNvbHZlZFBsdWdpblxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgYFRoZSBmb2xsb3dpbmcgZXJyb3Igb2NjdXJyZWQgaW4gdGhlIHBsdWdpbjogXCIke29yaWdpbmFsTG9jYXRpb259XCJgXG4gICAgICApXG4gICAgICB0aHJvdyBlcnJcbiAgICB9XG4gIH1cblxuICBzdGF0ZSA9IHtcbiAgICAuLi5zdGF0ZSxcbiAgICBwbHVnaW5zOiBjb25maWcucGx1Z2lucy5tYXAocmVzb2x2ZVBsdWdpbiksXG4gICAgY29uZmlnLFxuICB9XG5cbiAgcmV0dXJuIGNvcmVQbHVnaW5zLmFmdGVyR2V0Q29uZmlnKHN0YXRlKVxufVxuXG5mdW5jdGlvbiByZXNvbHZlTW9kdWxlKHBhdGgsIGNvbmZpZykge1xuICB0cnkge1xuICAgIC8vIExvYWQgYW55IG1vZHVsZSBleHRlbnNpb24gdGhhdCBpcyBzdXBwb3J0ZWQgYnkgTm9kZSAoLmpzLCAubWpzLCAubm9kZSwgZXRjKSxcbiAgICAvLyBvciB0aGF0IGhhdmUgYmVlbiByZWdpc3RlcmVkIHZpYSBOb2RlIHJlcXVpcmUgaG9va3MgKC5qc3gsIC50cywgZXRjKVxuICAgIHJldHVybiByZXF1aXJlLnJlc29sdmUocGF0aClcbiAgfSBjYXRjaCB7XG4gICAgLy8gRmFsbGJhY2sgdG8gdGhlIGV4dGVuc2lvbnMgdGhhdCBoYXZlIGJlZW4gcmVnaXN0ZXJlZCB3aXRoIEJhYmVsXG4gICAgY29uc3QgZXh0ZW5zaW9ucyA9IChjb25maWcgJiYgY29uZmlnLmV4dGVuc2lvbnMpIHx8IERFRkFVTFRfRVhURU5TSU9OU1xuICAgIHJldHVybiBleHRlbnNpb25zLm1hcChleHQgPT4gcGF0aCArIGV4dCkuZmluZChmcy5wYXRoRXhpc3RzU3luYylcbiAgfVxufVxuIl19